var ht=Object.defineProperty;var Ae=n=>{throw TypeError(n)};var ft=(n,e,t)=>e in n?ht(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>ft(n,typeof e!="symbol"?e+"":e,t),Ee=(n,e,t)=>e.has(n)||Ae("Cannot "+t);var l=(n,e,t)=>(Ee(n,e,"read from private field"),t?t.call(n):e.get(n)),p=(n,e,t)=>e.has(n)?Ae("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),y=(n,e,t,r)=>(Ee(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),b=(n,e,t)=>(Ee(n,e,"access private method"),t);var fe=(n,e,t,r)=>({set _(i){y(n,e,i,t)},get _(){return l(n,e,r)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var te;(function(n){n.MX_CREATIVE_KEYPAD="mx-creative-keypad"})(te||(te={}));const Ge={[te.MX_CREATIVE_KEYPAD]:"MX Creative Keypad"};function dt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var We={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,h,u){this.fn=c,this.context=h,this.once=u||!1}function s(c,h,u,f,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var x=new i(u,f||c,g),m=t?t+h:h;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],x]:c._events[m].push(x):(c._events[m]=x,c._eventsCount++),c}function o(c,h){--c._eventsCount===0?c._events=new r:delete c._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],u,f;if(this._eventsCount===0)return h;for(f in u=this._events)e.call(u,f)&&h.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},a.prototype.listeners=function(h){var u=t?t+h:h,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,x=f.length,m=new Array(x);g<x;g++)m[g]=f[g].fn;return m},a.prototype.listenerCount=function(h){var u=t?t+h:h,f=this._events[u];return f?f.fn?1:f.length:0},a.prototype.emit=function(h,u,f,g,x,m){var S=t?t+h:h;if(!this._events[S])return!1;var d=this._events[S],_=arguments.length,A,v;if(d.fn){switch(d.once&&this.removeListener(h,d.fn,void 0,!0),_){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,f),!0;case 4:return d.fn.call(d.context,u,f,g),!0;case 5:return d.fn.call(d.context,u,f,g,x),!0;case 6:return d.fn.call(d.context,u,f,g,x,m),!0}for(v=1,A=new Array(_-1);v<_;v++)A[v-1]=arguments[v];d.fn.apply(d.context,A)}else{var ve=d.length,re;for(v=0;v<ve;v++)switch(d[v].once&&this.removeListener(h,d[v].fn,void 0,!0),_){case 1:d[v].fn.call(d[v].context);break;case 2:d[v].fn.call(d[v].context,u);break;case 3:d[v].fn.call(d[v].context,u,f);break;case 4:d[v].fn.call(d[v].context,u,f,g);break;default:if(!A)for(re=1,A=new Array(_-1);re<_;re++)A[re-1]=arguments[re];d[v].fn.apply(d[v].context,A)}}return!0},a.prototype.on=function(h,u,f){return s(this,h,u,f,!1)},a.prototype.once=function(h,u,f){return s(this,h,u,f,!0)},a.prototype.removeListener=function(h,u,f,g){var x=t?t+h:h;if(!this._events[x])return this;if(!u)return o(this,x),this;var m=this._events[x];if(m.fn)m.fn===u&&(!g||m.once)&&(!f||m.context===f)&&o(this,x);else{for(var S=0,d=[],_=m.length;S<_;S++)(m[S].fn!==u||g&&!m[S].once||f&&m[S].context!==f)&&d.push(m[S]);d.length?this._events[x]=d.length===1?d[0]:d:o(this,x)}return this},a.prototype.removeAllListeners=function(h){var u;return h?(u=t?t+h:h,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(We);var gt=We.exports;const Re=dt(gt);var H,O,oe;class mt extends Re{constructor(t,r,i){var s;super();E(this,"device");E(this,"deviceProperties");p(this,H);p(this,O);p(this,oe);this.device=t,this.deviceProperties=i.deviceProperties,y(this,H,i.properties),y(this,O,i.buttonsLcd),y(this,oe,i.inputService),(s=i.events)==null||s.listen((o,...a)=>this.emit(o,...a)),this.device.on("input",(o,a)=>l(this,oe).handleInput(o,a)),this.device.on("error",o=>{this.emit("error",o)})}get CONTROLS(){return this.deviceProperties.CONTROLS}get MODEL(){return this.deviceProperties.MODEL}get PRODUCT_NAME(){return this.deviceProperties.PRODUCT_NAME}checkValidKeyIndex(t,r){const i=this.deviceProperties.CONTROLS.find(s=>s.type==="button"&&s.index===t);if(!i)throw new TypeError("Expected a valid keyIndex");if(r&&i.feedbackType!==r)throw new TypeError("Expected a keyIndex with expected feedbackType")}calculateFillPanelDimensions(t){return l(this,O).calculateFillPanelDimensions(t)}async close(){return this.device.close()}async getHidDeviceInfo(){return this.device.getDeviceInfo()}async setBrightness(t){return l(this,H).setBrightness(t)}async resetToLogo(){return l(this,H).resetToLogo()}async fillKeyColor(t,r,i,s){this.checkValidKeyIndex(t,null),await l(this,O).fillKeyColor(t,r,i,s)}async fillKeyBuffer(t,r,i){this.checkValidKeyIndex(t,"lcd"),await l(this,O).fillKeyBuffer(t,r,i)}async fillPanelBuffer(t,r){await l(this,O).fillPanelBuffer(t,r)}async clearKey(t){this.checkValidKeyIndex(t,null),await l(this,O).clearKey(t)}async clearPanel(){const t=[];t.push(l(this,O).clearPanel()),await Promise.all(t)}}H=new WeakMap,O=new WeakMap,oe=new WeakMap;function yt(n,e,t,r,i,s=0){const o=[];for(let a=0;a<e;a++)for(let c=0;c<n;c++){const h=a*n+c,u=h+1;o.push({type:"button",row:a,column:c+s,index:h,hidId:u,feedbackType:"lcd",pixelSize:t,pixelPosition:{x:r.x+c*(t.width+i.x),y:r.y+a*(t.height+i.y)}})}return o}function pt(n){return Object.freeze(n.map(e=>Object.freeze(e)))}var q;class wt{constructor(){p(this,q,null)}emit(e,...t){if(!l(this,q))throw new Error("No listener setup");l(this,q).call(this,e,...t)}listen(e){y(this,q,e)}}q=new WeakMap;var G,W,X,R;class xt{constructor(e,t,r,i){p(this,G);p(this,W);p(this,X);p(this,R);y(this,G,e),y(this,W,t),y(this,X,r),y(this,R,i)}getLcdButtonControls(){return l(this,R).CONTROLS.filter(e=>e.type==="button"&&e.feedbackType==="lcd")}calculateLcdGridSpan(e){if(e.length===0)return null;const t=e.map(i=>i.row),r=e.map(i=>i.column);return{minRow:Math.min(...t),maxRow:Math.max(...t),minCol:Math.min(...r),maxCol:Math.max(...r)}}calculateDimensionsFromGridSpan(e,t,r){if(r)throw new Error("Not implemented");{const i=e.maxRow-e.minRow+1;return{width:(e.maxCol-e.minCol+1)*t.width,height:i*t.height}}}calculateFillPanelDimensions(e){const t=this.getLcdButtonControls(),r=this.calculateLcdGridSpan(t);return!r||t.length===0?null:this.calculateDimensionsFromGridSpan(r,t[0].pixelSize,e==null?void 0:e.withPadding)}async clearPanel(){const e=[],t=new Uint8Array(l(this,R).PANEL_SIZE.width*l(this,R).PANEL_SIZE.height*4),r=await l(this,W).convertPixelBuffer(t,{format:"rgba",offset:0,stride:l(this,R).PANEL_SIZE.width*4},l(this,R).PANEL_SIZE),i=l(this,G).generateFillImageWrites({pixelSize:l(this,R).PANEL_SIZE,pixelPosition:{x:0,y:0}},r);e.push(l(this,X).sendReports(i)),await Promise.all(e)}async clearKey(e){const t=l(this,R).CONTROLS.find(i=>i.type==="button"&&i.index===e);if(!t||t.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const r=new Uint8Array(t.pixelSize.width*t.pixelSize.height*3);await this.fillImageRangeControl(t,r,{format:"rgb",offset:0,stride:t.pixelSize.width*3})}async fillKeyColor(e,t,r,i){this.checkRGBValue(t),this.checkRGBValue(r),this.checkRGBValue(i);const s=l(this,R).CONTROLS.find(u=>u.type==="button"&&u.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height,a=new Uint8Array(o*4),c=new DataView(a.buffer,a.byteOffset,a.byteLength);c.setUint8(0,t),c.setUint8(1,r),c.setUint8(2,i),c.setUint8(3,255);const h=c.getUint32(0);for(let u=1;u<o;u++)c.setUint32(u*4,h);await this.fillImageRangeControl(s,a,{format:"rgba",offset:0,stride:s.pixelSize.width*4})}async fillKeyBuffer(e,t,r){const i=(r==null?void 0:r.format)??"rgb";this.checkSourceFormat(i);const s=l(this,R).CONTROLS.find(a=>a.type==="button"&&a.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height*i.length;if(t.length!==o)throw new RangeError(`Expected image buffer of length ${o}, got length ${t.length}`);await this.fillImageRangeControl(s,t,{format:i,offset:0,stride:s.pixelSize.width*i.length})}async fillPanelBuffer(e,t){const r=(t==null?void 0:t.format)??"rgb";this.checkSourceFormat(r);const i=this.getLcdButtonControls(),s=this.calculateLcdGridSpan(i);if(!s||i.length===0)throw new Error("Panel does not support being filled");const o=this.calculateDimensionsFromGridSpan(s,i[0].pixelSize,t==null?void 0:t.withPadding),a=r.length*o.width*o.height;if(e.length!==a)throw new RangeError(`Expected image buffer of length ${a}, got length ${e.length}`);const c=o.width*r.length,h=[];for(const u of i){const f=u.row-s.minRow,g=u.column-s.minCol,x=u.pixelSize.width*r.length,m=c*f*u.pixelSize.height,S=g*x;h.push(this.fillImageRangeControl(u,e,{format:r,offset:m+S,stride:c}))}await Promise.all(h)}async fillImageRangeControl(e,t,r){if(e.feedbackType!=="lcd")throw new TypeError(`keyIndex ${e.index} does not support lcd feedback`);const i=await l(this,W).convertPixelBuffer(t,r,e.pixelSize),s=l(this,G).generateFillImageWrites({pixelSize:e.pixelSize,pixelPosition:e.pixelPosition},i);await l(this,X).sendReports(s)}checkRGBValue(e){if(e<0||e>255)throw new TypeError("Expected a valid color RGB value 0 - 255")}checkSourceFormat(e){switch(e){case"rgb":case"rgba":case"bgr":case"bgra":break;default:{const t=e;throw new TypeError(`Expected a known color format not "${t}"`)}}}}G=new WeakMap,W=new WeakMap,X=new WeakMap,R=new WeakMap;function vt(n,e,t,r,i,s){const o=se(n),a=new Uint8Array(r+i*s*t.colorMode.length),c=se(a),h=e.format.substring(0,3)!==t.colorMode.substring(0,3);for(let u=0;u<s;u++){const f=r+i*t.colorMode.length*u;for(let g=0;g<i;g++){let x=t.xFlip?i-g-1:g,m=t.yFlip?s-u-1:u;if(t.rotate){const ve=x;x=m,m=ve}const S=m*e.stride+e.offset+x*e.format.length,d=o.getUint8(S),_=o.getUint8(S+1),A=o.getUint8(S+2),v=f+g*t.colorMode.length;h?(c.setUint8(v,A),c.setUint8(v+1,_),c.setUint8(v+2,d)):(c.setUint8(v,d),c.setUint8(v+1,_),c.setUint8(v+2,A)),t.colorMode.length===4&&c.setUint8(v+3,255)}}return a}function se(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}var ae;class Et{constructor(e){p(this,ae);y(this,ae,e)}async convertPixelBuffer(e,t,r){const i=vt(e,t,{colorMode:"rgba"},0,r.width,r.height);return l(this,ae).call(this,i,r.width,r.height)}}ae=new WeakMap;class bt{generateFillImageWrites(e,t){const i=[],o=new Uint8Array(4095),a=Math.min(t.length,4075);o.set(t.subarray(0,a),20);const c=se(o);c.setUint8(0,20),c.setUint8(1,255),c.setUint8(2,2),c.setUint8(3,43),c.setUint8(4,Oe(1,!0,a>=t.length)),c.setUint16(5,256),c.setUint16(7,256),c.setUint16(9,e.pixelPosition.x),c.setUint16(11,e.pixelPosition.y),c.setUint16(13,e.pixelSize.width),c.setUint16(15,e.pixelSize.height),c.setUint16(18,t.length),i.push(o);let h=t.length-a;for(let u=2;h>0;u++){const f=new Uint8Array(4095),g=Math.min(h,4090),x=t.length-h;h-=g,f.set(t.subarray(x,x+g),5);const m=se(f);m.setUint8(0,20),m.setUint8(1,255),m.setUint8(2,2),m.setUint8(3,43),m.setUint8(4,Oe(u,!1,h===0)),i.push(f)}return i}}function Oe(n,e,t){let r=n|32;return e&&(r|=128),t&&(r|=64),r}var B,K,z,N,ne,Xe,je;class St{constructor(e,t){p(this,ne);E(this,"deviceProperties");p(this,B);p(this,K,new Map);p(this,z,new Set);p(this,N,new Set);this.deviceProperties=e,y(this,B,t);for(const r of this.deviceProperties.CONTROLS)r.type==="button"&&l(this,K).set(r.hidId,r)}handleInput(e,t){if(t[2]===43)return;const r=se(t);e===19?b(this,ne,Xe).call(this,r):e===17&&b(this,ne,je).call(this,r)}}B=new WeakMap,K=new WeakMap,z=new WeakMap,N=new WeakMap,ne=new WeakSet,Xe=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==2||e.getUint8(2)!==0||e.getUint8(4)!==1)return;const t=[],r=new Set;for(let i=5;i<e.byteLength;i+=1){const s=e.getInt8(i);if(s===0)break;const o=l(this,K).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,z)){if(r.has(i))continue;const s=l(this,K).get(i);s&&l(this,B).emit("up",s),l(this,z).delete(i)}for(const i of t)l(this,z).has(i.hidId)||(l(this,z).add(i.hidId),l(this,B).emit("down",i))},je=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==11||e.getUint8(2)!==0)return;const t=[],r=new Set;for(let i=3;i<e.byteLength;i+=2){const s=e.getUint16(i,!1);if(s===0)break;const o=l(this,K).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,N)){if(r.has(i))continue;const s=l(this,K).get(i);s&&l(this,B).emit("up",s),l(this,N).delete(i)}for(const i of t)l(this,N).has(i.hidId)||(l(this,N).add(i.hidId),l(this,B).emit("down",i))};var j;class Ct{constructor(e){p(this,j);y(this,j,e)}async setBrightness(e){if(e<0||e>100)throw new RangeError("Expected brightness percentage to be between 0 and 100");e=Math.max(e,1);const t=new Uint8Array([17,255,15,43,0,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,j).sendReports([t])}async resetToLogo(){const e=new Uint8Array([3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,j).sendFeatureReport(e)}}j=new WeakMap;const be={MODEL:te.MX_CREATIVE_KEYPAD,PRODUCT_NAME:Ge[te.MX_CREATIVE_KEYPAD],CONTROLS:pt([...yt(3,3,{width:118,height:118},{x:23,y:6},{x:40,y:40}),{type:"button",row:3,column:0,index:9,hidId:417,feedbackType:"none"},{type:"button",row:3,column:1,index:10,hidId:418,feedbackType:"none"}]),PANEL_SIZE:{width:480,height:480}};function Pt(n,e){const t=new wt;return new mt(n,e,{deviceProperties:be,events:t,properties:new Ct(n),buttonsLcd:new xt(new bt,new Et(e.encodeJPEG),n,be),inputService:new St(be,t)})}const It=[new Uint8Array([17,255,11,59,1,161,3,0,0,0,0,0,0,0,0,0,0,0,0,0]),new Uint8Array([17,255,11,59,1,162,3,0,0,0,0,0,0,0,0,0,0,0,0,0])];class Tt{constructor(e){E(this,"device");this.device=e}get CONTROLS(){return this.device.CONTROLS}get MODEL(){return this.device.MODEL}get PRODUCT_NAME(){return this.device.PRODUCT_NAME}calculateFillPanelDimensions(...e){return this.device.calculateFillPanelDimensions(...e)}async close(){return this.device.close()}async getHidDeviceInfo(...e){return this.device.getHidDeviceInfo(...e)}async fillKeyColor(...e){return this.device.fillKeyColor(...e)}async fillKeyBuffer(...e){return this.device.fillKeyBuffer(...e)}async fillPanelBuffer(...e){return this.device.fillPanelBuffer(...e)}async clearKey(...e){return this.device.clearKey(...e)}async clearPanel(...e){return this.device.clearPanel(...e)}async setBrightness(...e){return this.device.setBrightness(...e)}async resetToLogo(...e){return this.device.resetToLogo(...e)}eventNames(){return this.device.eventNames()}listeners(e){return this.device.listeners(e)}listenerCount(e){return this.device.listenerCount(e)}emit(e,...t){return this.device.emit(e,...t)}on(e,t,r){return this.device.on(e,t,r),this}addListener(e,t,r){return this.device.addListener(e,t,r),this}once(e,t,r){return this.device.once(e,t,r),this}removeListener(e,t,r,i){return this.device.removeListener(e,t,r,i),this}off(e,t,r,i){return this.device.off(e,t,r,i),this}removeAllListeners(e){return this.device.removeAllListeners(e),this}}const Le=1133,Rt={[te.MX_CREATIVE_KEYPAD]:{productIds:[50004],factory:Pt,initWrites:It}},Lt=Object.entries(Rt).map(([n,e])=>{const t=n;return{id:t,productName:Ge[t],...e}});class Ze extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Dt extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const ke=n=>globalThis.DOMException===void 0?new Dt(n):new DOMException(n),Ue=n=>{const e=n.reason===void 0?ke("This operation was aborted."):n.reason;return e instanceof Error?e:ke(e)};function _t(n,e){const{milliseconds:t,fallback:r,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o;const c=new Promise((h,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:g}=e;g.aborted&&u(Ue(g));const x=()=>{u(Ue(g))};g.addEventListener("abort",x,{once:!0}),n.finally(()=>{g.removeEventListener("abort",x)})}if(t===Number.POSITIVE_INFINITY){n.then(h,u);return}const f=new Ze;o=s.setTimeout.call(void 0,()=>{if(r){try{h(r())}catch(g){u(g)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?h():i instanceof Error?u(i):(f.message=i??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{h(await n)}catch(g){u(g)}})()}).finally(()=>{c.clear()});return c.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},c}function At(n,e,t){let r=0,i=n.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}var k;class Ot{constructor(){p(this,k,[])}enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,run:e};if(this.size&&l(this,k)[this.size-1].priority>=t.priority){l(this,k).push(r);return}const i=At(l(this,k),r,(s,o)=>o.priority-s.priority);l(this,k).splice(i,0,r)}dequeue(){const e=l(this,k).shift();return e==null?void 0:e.run}filter(e){return l(this,k).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return l(this,k).length}}k=new WeakMap;var Z,Y,V,ce,J,le,L,Q,C,ue,D,ee,$,he,w,Ye,Je,Qe,et,tt,ge,Pe,Ie,me,nt,ye;class kt extends Re{constructor(t){var r,i;super();p(this,w);p(this,Z);p(this,Y);p(this,V,0);p(this,ce);p(this,J);p(this,le,0);p(this,L);p(this,Q);p(this,C);p(this,ue);p(this,D,0);p(this,ee);p(this,$);p(this,he);E(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Ot,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);y(this,Z,t.carryoverConcurrencyCount),y(this,Y,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),y(this,ce,t.intervalCap),y(this,J,t.interval),y(this,C,new t.queueClass),y(this,ue,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,y(this,he,t.throwOnTimeout===!0),y(this,$,t.autoStart===!1)}get concurrency(){return l(this,ee)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);y(this,ee,t),b(this,w,me).call(this)}async add(t,r={}){return r={timeout:this.timeout,throwOnTimeout:l(this,he),...r},new Promise((i,s)=>{l(this,C).enqueue(async()=>{var o;fe(this,D)._++,fe(this,V)._++;try{(o=r.signal)==null||o.throwIfAborted();let a=t({signal:r.signal});r.timeout&&(a=_t(Promise.resolve(a),{milliseconds:r.timeout})),r.signal&&(a=Promise.race([a,b(this,w,nt).call(this,r.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof Ze&&!r.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{b(this,w,Qe).call(this)}},r),this.emit("add"),b(this,w,ge).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return l(this,$)?(y(this,$,!1),b(this,w,me).call(this),this):this}pause(){y(this,$,!0)}clear(){y(this,C,new(l(this,ue)))}async onEmpty(){l(this,C).size!==0&&await b(this,w,ye).call(this,"empty")}async onSizeLessThan(t){l(this,C).size<t||await b(this,w,ye).call(this,"next",()=>l(this,C).size<t)}async onIdle(){l(this,D)===0&&l(this,C).size===0||await b(this,w,ye).call(this,"idle")}get size(){return l(this,C).size}sizeBy(t){return l(this,C).filter(t).length}get pending(){return l(this,D)}get isPaused(){return l(this,$)}}Z=new WeakMap,Y=new WeakMap,V=new WeakMap,ce=new WeakMap,J=new WeakMap,le=new WeakMap,L=new WeakMap,Q=new WeakMap,C=new WeakMap,ue=new WeakMap,D=new WeakMap,ee=new WeakMap,$=new WeakMap,he=new WeakMap,w=new WeakSet,Ye=function(){return l(this,Y)||l(this,V)<l(this,ce)},Je=function(){return l(this,D)<l(this,ee)},Qe=function(){fe(this,D)._--,b(this,w,ge).call(this),this.emit("next")},et=function(){b(this,w,Ie).call(this),b(this,w,Pe).call(this),y(this,Q,void 0)},tt=function(){const t=Date.now();if(l(this,L)===void 0){const r=l(this,le)-t;if(r<0)y(this,V,l(this,Z)?l(this,D):0);else return l(this,Q)===void 0&&y(this,Q,setTimeout(()=>{b(this,w,et).call(this)},r)),!0}return!1},ge=function(){if(l(this,C).size===0)return l(this,L)&&clearInterval(l(this,L)),y(this,L,void 0),this.emit("empty"),l(this,D)===0&&this.emit("idle"),!1;if(!l(this,$)){const t=!l(this,w,tt);if(l(this,w,Ye)&&l(this,w,Je)){const r=l(this,C).dequeue();return r?(this.emit("active"),r(),t&&b(this,w,Pe).call(this),!0):!1}}return!1},Pe=function(){l(this,Y)||l(this,L)!==void 0||(y(this,L,setInterval(()=>{b(this,w,Ie).call(this)},l(this,J))),y(this,le,Date.now()+l(this,J)))},Ie=function(){l(this,V)===0&&l(this,D)===0&&l(this,L)&&(clearInterval(l(this,L)),y(this,L,void 0)),y(this,V,l(this,Z)?l(this,D):0),b(this,w,me).call(this)},me=function(){for(;b(this,w,ge).call(this););},nt=async function(t){return new Promise((r,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},ye=async function(t,r){return new Promise(i=>{const s=()=>{r&&!r()||(this.off(t,s),i())};this.on(t,s)})};class Ut extends Re{constructor(t){super();E(this,"device");E(this,"reportQueue",new kt({concurrency:1}));this.device=t,this.device.addEventListener("inputreport",r=>{const i=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength);this.emit("input",r.reportId,i)})}async close(){return this.device.close()}async forget(){return this.device.forget()}async sendFeatureReport(t){return this.device.sendFeatureReport(t[0],t.subarray(1))}async getFeatureReport(t,r){const i=await this.device.receiveFeatureReport(t);return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}async sendReports(t){return this.reportQueue.add(async()=>{for(const r of t)await this.device.sendReport(r[0],r.subarray(1))})}async getDeviceInfo(){return{path:void 0,productId:this.device.productId,vendorId:this.device.vendorId,serialNumber:void 0}}}async function Mt(n,e,t){const r=await new Promise((i,s)=>{const o=document.createElement("canvas");o.width=e,o.height=t;const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=a.createImageData(e,t);c.data.set(n),a.putImageData(c,0,0),o.toBlob(h=>{h?i(h):s(new Error("No image generated"))},"image/jpeg",.9)}else s(new Error("Failed to get canvas context"))});return new Uint8Array(await r.arrayBuffer())}class $t extends Tt{constructor(t,r){super(t);E(this,"hid");this.hid=r}async forget(){await this.hid.forget()}async fillKeyCanvas(t,r){const i=r.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Failed to get canvas context");const s=this.CONTROLS.find(a=>a.type==="button"&&a.index===t);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=i.getImageData(0,0,s.pixelSize.width,s.pixelSize.height);return this.device.fillKeyBuffer(t,o.data,{format:"rgba"})}async fillPanelCanvas(t){const r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("Failed to get canvas context");const i=this.device.calculateFillPanelDimensions();if(!i)throw new Error("Panel does not support filling");const s=r.getImageData(0,0,i.width,i.height);return this.device.fillPanelBuffer(s.data,{format:"rgba"})}}async function Ft(n){const e=await navigator.hid.requestDevice({filters:[{vendorId:Le}]});return Promise.all(e.map(async t=>rt(t,n)))}async function Bt(n){const t=(await navigator.hid.getDevices()).filter(i=>i.vendorId===Le);return(await Promise.all(t.map(async i=>rt(i,n).catch(s=>null)))).filter(i=>!!i)}async function rt(n,e){const t=Lt.find(r=>n.vendorId===Le&&r.productIds.includes(n.productId));if(!t)throw new Error("Stream Deck is of unexpected type.");await n.open();try{const r={encodeJPEG:Mt,...e},i=new Ut(n);t.initWrites&&await i.sendReports(t.initWrites);const s=t.factory(i,r||{});return new $t(s,i)}catch(r){throw await n.close().catch(()=>null),r}}function Kt(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const t=document.implementation.createHTMLDocument(),r=t.createElement("base"),i=t.createElement("a");return t.head.appendChild(r),t.body.appendChild(i),e&&(r.href=e),i.href=n,i.href}const Vt=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function F(n){const e=[];for(let t=0,r=n.length;t<r;t++)e.push(n[t]);return e}function pe(n,e){const r=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return r?parseFloat(r.replace("px","")):0}function zt(n){const e=pe(n,"border-left-width"),t=pe(n,"border-right-width");return n.clientWidth+e+t}function Nt(n){const e=pe(n,"border-top-width"),t=pe(n,"border-bottom-width");return n.clientHeight+e+t}function it(n,e={}){const t=e.width||zt(n),r=e.height||Nt(n);return{width:t,height:r}}function Ht(){let n,e;try{e=process}catch{}const t=e&&e.env?e.env.devicePixelRatio:null;return t&&(n=parseInt(t,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const T=16384;function qt(n){(n.width>T||n.height>T)&&(n.width>T&&n.height>T?n.width>n.height?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T):n.width>T?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T))}function we(n){return new Promise((e,t)=>{const r=new Image;r.decode=()=>e(r),r.onload=()=>e(r),r.onerror=t,r.crossOrigin="anonymous",r.decoding="async",r.src=n})}async function Gt(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Wt(n,e,t){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${t}`),i.setAttribute("viewBox",`0 0 ${e} ${t}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(n),Gt(i)}const I=(n,e)=>{if(n instanceof e)return!0;const t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||I(t,e)};function Xt(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function jt(n){return F(n).map(e=>{const t=n.getPropertyValue(e),r=n.getPropertyPriority(e);return`${e}: ${t}${r?" !important":""};`}).join(" ")}function Zt(n,e,t){const r=`.${n}:${e}`,i=t.cssText?Xt(t):jt(t);return document.createTextNode(`${r}{${i}}`)}function Me(n,e,t){const r=window.getComputedStyle(n,t),i=r.getPropertyValue("content");if(i===""||i==="none")return;const s=Vt();try{e.className=`${e.className} ${s}`}catch{return}const o=document.createElement("style");o.appendChild(Zt(s,t,r)),e.appendChild(o)}function Yt(n,e){Me(n,e,":before"),Me(n,e,":after")}const $e="application/font-woff",Fe="image/jpeg",Jt={woff:$e,woff2:$e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Fe,jpeg:Fe,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Qt(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function De(n){const e=Qt(n).toLowerCase();return Jt[e]||""}function en(n){return n.split(/,/)[1]}function Te(n){return n.search(/^(data:)/)!==-1}function tn(n,e){return`data:${e};base64,${n}`}async function st(n,e,t){const r=await fetch(n,e);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((s,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{s(t({res:r,result:a.result}))}catch(c){o(c)}},a.readAsDataURL(i)})}const Se={};function nn(n,e,t){let r=n.replace(/\?.*/,"");return t&&(r=n),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}async function _e(n,e,t){const r=nn(n,e,t.includeQueryParams);if(Se[r]!=null)return Se[r];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let i;try{const s=await st(n,t.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),en(a)));i=tn(s,e)}catch(s){i=t.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return Se[r]=i,i}async function rn(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):we(e)}async function sn(n,e){if(n.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=n.clientWidth,s.height=n.clientHeight,o==null||o.drawImage(n,0,0,s.width,s.height);const a=s.toDataURL();return we(a)}const t=n.poster,r=De(t),i=await _e(t,r,e);return we(i)}async function on(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await xe(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function an(n,e){return I(n,HTMLCanvasElement)?rn(n):I(n,HTMLVideoElement)?sn(n,e):I(n,HTMLIFrameElement)?on(n):n.cloneNode(!1)}const cn=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function ln(n,e,t){var r,i;let s=[];return cn(n)&&n.assignedNodes?s=F(n.assignedNodes()):I(n,HTMLIFrameElement)&&(!((r=n.contentDocument)===null||r===void 0)&&r.body)?s=F(n.contentDocument.body.childNodes):s=F(((i=n.shadowRoot)!==null&&i!==void 0?i:n).childNodes),s.length===0||I(n,HTMLVideoElement)||await s.reduce((o,a)=>o.then(()=>xe(a,t)).then(c=>{c&&e.appendChild(c)}),Promise.resolve()),e}function un(n,e){const t=e.style;if(!t)return;const r=window.getComputedStyle(n);r.cssText?(t.cssText=r.cssText,t.transformOrigin=r.transformOrigin):F(r).forEach(i=>{let s=r.getPropertyValue(i);i==="font-size"&&s.endsWith("px")&&(s=`${Math.floor(parseFloat(s.substring(0,s.length-2)))-.1}px`),I(n,HTMLIFrameElement)&&i==="display"&&s==="inline"&&(s="block"),i==="d"&&e.getAttribute("d")&&(s=`path(${e.getAttribute("d")})`),t.setProperty(i,s,r.getPropertyPriority(i))})}function hn(n,e){I(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),I(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function fn(n,e){if(I(n,HTMLSelectElement)){const t=e,r=Array.from(t.children).find(i=>n.value===i.getAttribute("value"));r&&r.setAttribute("selected","")}}function dn(n,e){return I(e,Element)&&(un(n,e),Yt(n,e),hn(n,e),fn(n,e)),e}async function gn(n,e){const t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;const r={};for(let s=0;s<t.length;s++){const a=t[s].getAttribute("xlink:href");if(a){const c=n.querySelector(a),h=document.querySelector(a);!c&&h&&!r[a]&&(r[a]=await xe(h,e,!0))}}const i=Object.values(r);if(i.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(s,"defs");o.appendChild(a);for(let c=0;c<i.length;c++)a.appendChild(i[c]);n.appendChild(o)}return n}async function xe(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(r=>an(r,e)).then(r=>ln(n,r,e)).then(r=>dn(n,r)).then(r=>gn(r,e))}const ot=/url\((['"]?)([^'"]+?)\1\)/g,mn=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,yn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function pn(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function wn(n){const e=[];return n.replace(ot,(t,r,i)=>(e.push(i),t)),e.filter(t=>!Te(t))}async function xn(n,e,t,r,i){try{const s=t?Kt(e,t):e,o=De(e);let a;return i||(a=await _e(s,o,r)),n.replace(pn(e),`$1${a}$3`)}catch{}return n}function vn(n,{preferredFontFormat:e}){return e?n.replace(yn,t=>{for(;;){const[r,,i]=mn.exec(t)||[];if(!i)return"";if(i===e)return`src: ${r};`}}):n}function at(n){return n.search(ot)!==-1}async function ct(n,e,t){if(!at(n))return n;const r=vn(n,t);return wn(r).reduce((s,o)=>s.then(a=>xn(a,o,e,t)),Promise.resolve(r))}async function de(n,e,t){var r;const i=(r=e.style)===null||r===void 0?void 0:r.getPropertyValue(n);if(i){const s=await ct(i,null,t);return e.style.setProperty(n,s,e.style.getPropertyPriority(n)),!0}return!1}async function En(n,e){await de("background",n,e)||await de("background-image",n,e),await de("mask",n,e)||await de("mask-image",n,e)}async function bn(n,e){const t=I(n,HTMLImageElement);if(!(t&&!Te(n.src))&&!(I(n,SVGImageElement)&&!Te(n.href.baseVal)))return;const r=t?n.src:n.href.baseVal,i=await _e(r,De(r),e);await new Promise((s,o)=>{n.onload=s,n.onerror=o;const a=n;a.decode&&(a.decode=s),a.loading==="lazy"&&(a.loading="eager"),t?(n.srcset="",n.src=i):n.href.baseVal=i})}async function Sn(n,e){const r=F(n.childNodes).map(i=>lt(i,e));await Promise.all(r).then(()=>n)}async function lt(n,e){I(n,Element)&&(await En(n,e),await bn(n,e),await Sn(n,e))}function Cn(n,e){const{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);const r=e.style;return r!=null&&Object.keys(r).forEach(i=>{t[i]=r[i]}),n}const Be={};async function Ke(n){let e=Be[n];if(e!=null)return e;const r=await(await fetch(n)).text();return e={url:n,cssText:r},Be[n]=e,e}async function Ve(n,e){let t=n.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(t.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(r,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),st(a,e.fetchRequestInit,({result:c})=>(t=t.replace(o,`url(${c})`),[o,c]))});return Promise.all(s).then(()=>t)}function ze(n){if(n==null)return[];const e=[],t=/(\/\*[\s\S]*?\*\/)/gi;let r=n.replace(t,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=i.exec(r);if(c===null)break;e.push(c[0])}r=r.replace(i,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let c=s.exec(r);if(c===null){if(c=a.exec(r),c===null)break;s.lastIndex=a.lastIndex}else a.lastIndex=s.lastIndex;e.push(c[0])}return e}async function Pn(n,e){const t=[],r=[];return n.forEach(i=>{if("cssRules"in i)try{F(i.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let a=o+1;const c=s.href,h=Ke(c).then(u=>Ve(u,e)).then(u=>ze(u).forEach(f=>{try{i.insertRule(f,f.startsWith("@import")?a+=1:i.cssRules.length)}catch(g){console.error("Error inserting rule from remote css",{rule:f,error:g})}})).catch(u=>{console.error("Error loading remote css",u.toString())});r.push(h)}})}catch(s){const o=n.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&r.push(Ke(i.href).then(a=>Ve(a,e)).then(a=>ze(a).forEach(c=>{o.insertRule(c,i.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(n.forEach(i=>{if("cssRules"in i)try{F(i.cssRules||[]).forEach(s=>{t.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${i.href}`,s)}}),t))}function In(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>at(e.style.getPropertyValue("src")))}async function Tn(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const t=F(n.ownerDocument.styleSheets),r=await Pn(t,e);return In(r)}async function Rn(n,e){const t=await Tn(n,e);return(await Promise.all(t.map(i=>{const s=i.parentStyleSheet?i.parentStyleSheet.href:null;return ct(i.cssText,s,e)}))).join(`
`)}async function Ln(n,e){const t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Rn(n,e);if(t){const r=document.createElement("style"),i=document.createTextNode(t);r.appendChild(i),n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r)}}async function Dn(n,e={}){const{width:t,height:r}=it(n,e),i=await xe(n,e,!0);return await Ln(i,e),await lt(i,e),Cn(i,e),await Wt(i,t,r)}async function _n(n,e={}){const{width:t,height:r}=it(n,e),i=await Dn(n,e),s=await we(i),o=document.createElement("canvas"),a=o.getContext("2d"),c=e.pixelRatio||Ht(),h=e.canvasWidth||t,u=e.canvasHeight||r;return o.width=h*c,o.height=u*c,e.skipAutoScale||qt(o),o.style.width=`${h}`,o.style.height=`${u}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}function An(){const n="0123456789ABCDEF";let e="#";for(let t=0;t<6;t++)e+=n[Math.floor(Math.random()*16)];return e}class On{constructor(){E(this,"element");E(this,"run",!1);E(this,"running")}async start(e){const t=e.calculateFillPanelDimensions();if(this.element=document.querySelector("#image-source")||void 0,this.element&&(this.element.style.display="block",t&&(this.element.style.width=`${t.width}px`,this.element.style.height=`${t.height}px`)),!this.run){this.run=!0;const r=()=>{if(this.element&&this.run){const i=this.element;_n(i).then(async s=>{this.running=e.fillPanelCanvas(s),await this.running,this.running=void 0,r()}).catch(console.error)}};r()}}async stop(e){this.element&&(this.element.style.display="none"),this.run=!1,await this.running,await e.clearPanel()}async keyDown(e,t){this.element&&(this.element.style.background=An())}async keyUp(e,t){}}class ut{constructor(){E(this,"pressed",[])}async start(e){await e.clearPanel()}async stop(e){await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}function Ce(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n+1))+n}class kn{constructor(){E(this,"interval");E(this,"running")}async start(e){if(!this.interval){const t=async()=>{if(!this.running){const r=Ce(0,255),i=Ce(0,255),s=Ce(0,255);console.log("Filling with rgb(%d, %d, %d)",r,i,s);const o=[];for(const a of e.CONTROLS)a.type==="button"&&a.feedbackType!=="none"&&o.push(e.fillKeyColor(a.index,r,i,s));this.running=Promise.all(o),await this.running,this.running=void 0}};this.interval=window.setInterval(()=>{t().catch(r=>console.log(r))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){}async keyUp(e,t){}}class Un{constructor(){E(this,"pressed",[]);E(this,"counter",0);E(this,"interval");E(this,"running")}async drawButtons(e,t,r){const i=[];for(const{control:s,canvas:o}of t){const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=r+s.index;a.save(),a.clearRect(0,0,o.width,o.height),a.font=`${o.height*.8}px "Arial"`,a.strokeStyle="blue",a.lineWidth=1,a.strokeText(c.toString(),8,o.height*.9,o.width*.8),a.fillStyle="white",a.fillText(c.toString(),8,o.height*.9,o.width*.8);const h=a.getImageData(0,0,o.width,o.height);i.push(e.fillKeyBuffer(s.index,h.data,{format:"rgba"})),a.restore()}}await Promise.all(i)}async start(e){await e.clearPanel(),this.counter=0;const r=e.CONTROLS.filter(i=>i.type==="button"&&i.feedbackType==="lcd").sort((i,s)=>s.index-i.index).map(i=>{const s=document.createElement("canvas");return s.width=i.pixelSize.width,s.height=i.pixelSize.height,{control:i,canvas:s}});if(await this.drawButtons(e,r,this.counter),!this.interval){const i=async()=>{this.running||(this.running=this.drawButtons(e,r,++this.counter),await this.running,this.running=void 0)};this.interval=window.setInterval(()=>{i().catch(s=>console.error(s))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}{const n=document.querySelector("#version_str");n&&(n.innerHTML="v0.1.0")}function U(n){const e=document.getElementById("log");e&&(e.textContent=`${n}
${e.textContent??""}`)}const ie=document.getElementById("demo-select"),Ne=document.getElementById("consent-button");let P=null,M=new ut;async function He(){if(ie){switch(console.log(`Selected demo: ${ie.value}`),P&&await M.stop(P),ie.value){case"rapid-fill":M=new kn;break;case"dom":M=new On;break;case"chase":M=new Un;break;case"fill-when-pressed":default:M=new ut;break}P&&await M.start(P)}}async function qe(n){const e=await n.getHidDeviceInfo();U(`Device opened. Serial: ${e.serialNumber}`),n.on("down",t=>{t.type==="button"?(U(`Key ${t.index} down`),M.keyDown(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("up",t=>{t.type==="button"?(U(`Key ${t.index} up`),M.keyUp(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("rotate",(t,r)=>{U(`Encoder ${t.index} rotate (${r})`)}),await M.start(n),await n.setBrightness(70)}if(Ne){const n=async()=>{const r=await Bt();r.length>0&&(P=r[0],qe(P).catch(console.error)),console.log(r)};window.addEventListener("load",()=>{n().catch(r=>console.error(r))});const e=document.getElementById("brightness-range");e&&e.addEventListener("input",r=>{const i=e.value;P&&P.setBrightness(i).catch(console.error)}),ie&&(ie.addEventListener("input",()=>{He().catch(console.error)}),He().catch(console.error));const t=async()=>{P&&(U("Closing device"),M.stop(P).catch(console.error),await P.close(),P=null);try{const r=await Ft();if(P=r[0],r.length===0){U("No device was selected");return}}catch(r){U(`No device access granted: ${r}`);return}qe(P).catch(console.error)};Ne.addEventListener("click",()=>{t().catch(r=>console.error(r))}),U("Page loaded")}
