var wt=Object.defineProperty;var Ue=n=>{throw TypeError(n)};var xt=(n,e,t)=>e in n?wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>xt(n,typeof e!="symbol"?e+"":e,t),Se=(n,e,t)=>e.has(n)||Ue("Cannot "+t);var l=(n,e,t)=>(Se(n,e,"read from private field"),t?t.call(n):e.get(n)),g=(n,e,t)=>e.has(n)?Ue("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),y=(n,e,t,r)=>(Se(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),E=(n,e,t)=>(Se(n,e,"access private method"),t);var oe=(n,e,t,r)=>({set _(i){y(n,e,i,t)},get _(){return l(n,e,r)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var z;(function(n){n.MX_CREATIVE_KEYPAD="mx-creative-keypad",n.MX_CREATIVE_DIALPAD="mx-creative-dialpad"})(z||(z={}));const je={[z.MX_CREATIVE_KEYPAD]:"MX Creative Keypad",[z.MX_CREATIVE_DIALPAD]:"MX Creative Dialpad"};function vt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ye={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,h,u){this.fn=c,this.context=h,this.once=u||!1}function s(c,h,u,f,m){if(typeof u!="function")throw new TypeError("The listener must be a function");var x=new i(u,f||c,m),p=t?t+h:h;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],x]:c._events[p].push(x):(c._events[p]=x,c._eventsCount++),c}function o(c,h){--c._eventsCount===0?c._events=new r:delete c._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],u,f;if(this._eventsCount===0)return h;for(f in u=this._events)e.call(u,f)&&h.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},a.prototype.listeners=function(h){var u=t?t+h:h,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var m=0,x=f.length,p=new Array(x);m<x;m++)p[m]=f[m].fn;return p},a.prototype.listenerCount=function(h){var u=t?t+h:h,f=this._events[u];return f?f.fn?1:f.length:0},a.prototype.emit=function(h,u,f,m,x,p){var C=t?t+h:h;if(!this._events[C])return!1;var d=this._events[C],_=arguments.length,O,v;if(d.fn){switch(d.once&&this.removeListener(h,d.fn,void 0,!0),_){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,f),!0;case 4:return d.fn.call(d.context,u,f,m),!0;case 5:return d.fn.call(d.context,u,f,m,x),!0;case 6:return d.fn.call(d.context,u,f,m,x,p),!0}for(v=1,O=new Array(_-1);v<_;v++)O[v-1]=arguments[v];d.fn.apply(d.context,O)}else{var Ce=d.length,se;for(v=0;v<Ce;v++)switch(d[v].once&&this.removeListener(h,d[v].fn,void 0,!0),_){case 1:d[v].fn.call(d[v].context);break;case 2:d[v].fn.call(d[v].context,u);break;case 3:d[v].fn.call(d[v].context,u,f);break;case 4:d[v].fn.call(d[v].context,u,f,m);break;default:if(!O)for(se=1,O=new Array(_-1);se<_;se++)O[se-1]=arguments[se];d[v].fn.apply(d[v].context,O)}}return!0},a.prototype.on=function(h,u,f){return s(this,h,u,f,!1)},a.prototype.once=function(h,u,f){return s(this,h,u,f,!0)},a.prototype.removeListener=function(h,u,f,m){var x=t?t+h:h;if(!this._events[x])return this;if(!u)return o(this,x),this;var p=this._events[x];if(p.fn)p.fn===u&&(!m||p.once)&&(!f||p.context===f)&&o(this,x);else{for(var C=0,d=[],_=p.length;C<_;C++)(p[C].fn!==u||m&&!p[C].once||f&&p[C].context!==f)&&d.push(p[C]);d.length?this._events[x]=d.length===1?d[0]:d:o(this,x)}return this},a.prototype.removeAllListeners=function(h){var u;return h?(u=t?t+h:h,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Ye);var Et=Ye.exports;const Ae=vt(Et);var X,k,le;class bt extends Ae{constructor(t,r,i){var s;super();b(this,"device");b(this,"deviceProperties");g(this,X);g(this,k);g(this,le);this.device=t,this.deviceProperties=i.deviceProperties,y(this,X,i.properties),y(this,k,i.buttonsLcd),y(this,le,i.inputService),(s=i.events)==null||s.listen((o,...a)=>this.emit(o,...a)),this.device.on("input",(o,a)=>l(this,le).handleInput(o,a)),this.device.on("error",o=>{this.emit("error",o)})}get CONTROLS(){return this.deviceProperties.CONTROLS}get MODEL(){return this.deviceProperties.MODEL}get PRODUCT_NAME(){return this.deviceProperties.PRODUCT_NAME}checkValidKeyIndex(t,r){const i=this.deviceProperties.CONTROLS.find(s=>s.type==="button"&&s.index===t);if(!i)throw new TypeError("Expected a valid keyIndex");if(r&&i.feedbackType!==r)throw new TypeError("Expected a keyIndex with expected feedbackType")}calculateFillPanelDimensions(t){return l(this,k).calculateFillPanelDimensions(t)}async close(){return this.device.close()}async getHidDeviceInfo(){return this.device.getDeviceInfo()}async setBrightness(t){return l(this,X).setBrightness(t)}async resetToLogo(){return l(this,X).resetToLogo()}async fillKeyColor(t,r,i,s){this.checkValidKeyIndex(t,null),await l(this,k).fillKeyColor(t,r,i,s)}async fillKeyBuffer(t,r,i){this.checkValidKeyIndex(t,"lcd"),await l(this,k).fillKeyBuffer(t,r,i)}async fillPanelBuffer(t,r){await l(this,k).fillPanelBuffer(t,r)}async clearKey(t){this.checkValidKeyIndex(t,null),await l(this,k).clearKey(t)}async clearPanel(){const t=[];t.push(l(this,k).clearPanel()),await Promise.all(t)}}X=new WeakMap,k=new WeakMap,le=new WeakMap;function Ct(n,e,t,r,i,s=0){const o=[];for(let a=0;a<e;a++)for(let c=0;c<n;c++){const h=a*n+c,u=h+1;o.push({type:"button",row:a,column:c+s,index:h,hidId:u,feedbackType:"lcd",pixelSize:t,pixelPosition:{x:r.x+c*(t.width+i.x),y:r.y+a*(t.height+i.y)}})}return o}function St(n){return Object.freeze(n.map(e=>Object.freeze(e)))}var W;class Pt{constructor(){g(this,W,null)}emit(e,...t){if(!l(this,W))throw new Error("No listener setup");l(this,W).call(this,e,...t)}listen(e){y(this,W,e)}}W=new WeakMap;var Z,j,Y,R;class It{constructor(e,t,r,i){g(this,Z);g(this,j);g(this,Y);g(this,R);y(this,Z,e),y(this,j,t),y(this,Y,r),y(this,R,i)}getLcdButtonControls(){return l(this,R).CONTROLS.filter(e=>e.type==="button"&&e.feedbackType==="lcd")}calculateLcdGridSpan(e){if(e.length===0)return null;const t=e.map(i=>i.row),r=e.map(i=>i.column);return{minRow:Math.min(...t),maxRow:Math.max(...t),minCol:Math.min(...r),maxCol:Math.max(...r)}}calculateDimensionsFromGridSpan(e,t,r){if(r)throw new Error("Not implemented");{const i=e.maxRow-e.minRow+1;return{width:(e.maxCol-e.minCol+1)*t.width,height:i*t.height}}}calculateFillPanelDimensions(e){const t=this.getLcdButtonControls(),r=this.calculateLcdGridSpan(t);return!r||t.length===0?null:this.calculateDimensionsFromGridSpan(r,t[0].pixelSize,e==null?void 0:e.withPadding)}async clearPanel(){const e=[],t=new Uint8Array(l(this,R).PANEL_SIZE.width*l(this,R).PANEL_SIZE.height*4),r=await l(this,j).convertPixelBuffer(t,{format:"rgba",offset:0,stride:l(this,R).PANEL_SIZE.width*4},l(this,R).PANEL_SIZE),i=l(this,Z).generateFillImageWrites({pixelSize:l(this,R).PANEL_SIZE,pixelPosition:{x:0,y:0}},r);e.push(l(this,Y).sendReports(i)),await Promise.all(e)}async clearKey(e){const t=l(this,R).CONTROLS.find(i=>i.type==="button"&&i.index===e);if(!t||t.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const r=new Uint8Array(t.pixelSize.width*t.pixelSize.height*3);await this.fillImageRangeControl(t,r,{format:"rgb",offset:0,stride:t.pixelSize.width*3})}async fillKeyColor(e,t,r,i){this.checkRGBValue(t),this.checkRGBValue(r),this.checkRGBValue(i);const s=l(this,R).CONTROLS.find(u=>u.type==="button"&&u.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height,a=new Uint8Array(o*4),c=new DataView(a.buffer,a.byteOffset,a.byteLength);c.setUint8(0,t),c.setUint8(1,r),c.setUint8(2,i),c.setUint8(3,255);const h=c.getUint32(0);for(let u=1;u<o;u++)c.setUint32(u*4,h);await this.fillImageRangeControl(s,a,{format:"rgba",offset:0,stride:s.pixelSize.width*4})}async fillKeyBuffer(e,t,r){const i=(r==null?void 0:r.format)??"rgb";this.checkSourceFormat(i);const s=l(this,R).CONTROLS.find(a=>a.type==="button"&&a.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height*i.length;if(t.length!==o)throw new RangeError(`Expected image buffer of length ${o}, got length ${t.length}`);await this.fillImageRangeControl(s,t,{format:i,offset:0,stride:s.pixelSize.width*i.length})}async fillPanelBuffer(e,t){const r=(t==null?void 0:t.format)??"rgb";this.checkSourceFormat(r);const i=this.getLcdButtonControls(),s=this.calculateLcdGridSpan(i);if(!s||i.length===0)throw new Error("Panel does not support being filled");const o=this.calculateDimensionsFromGridSpan(s,i[0].pixelSize,t==null?void 0:t.withPadding),a=r.length*o.width*o.height;if(e.length!==a)throw new RangeError(`Expected image buffer of length ${a}, got length ${e.length}`);const c=o.width*r.length,h=[];for(const u of i){const f=u.row-s.minRow,m=u.column-s.minCol,x=u.pixelSize.width*r.length,p=c*f*u.pixelSize.height,C=m*x;h.push(this.fillImageRangeControl(u,e,{format:r,offset:p+C,stride:c}))}await Promise.all(h)}async fillImageRangeControl(e,t,r){if(e.feedbackType!=="lcd")throw new TypeError(`keyIndex ${e.index} does not support lcd feedback`);const i=await l(this,j).convertPixelBuffer(t,r,e.pixelSize),s=l(this,Z).generateFillImageWrites({pixelSize:e.pixelSize,pixelPosition:e.pixelPosition},i);await l(this,Y).sendReports(s)}checkRGBValue(e){if(e<0||e>255)throw new TypeError("Expected a valid color RGB value 0 - 255")}checkSourceFormat(e){switch(e){case"rgb":case"rgba":case"bgr":case"bgra":break;default:{const t=e;throw new TypeError(`Expected a known color format not "${t}"`)}}}}Z=new WeakMap,j=new WeakMap,Y=new WeakMap,R=new WeakMap;function Tt(n,e,t,r,i,s){const o=ce(n),a=new Uint8Array(r+i*s*t.colorMode.length),c=ce(a),h=e.format.substring(0,3)!==t.colorMode.substring(0,3);for(let u=0;u<s;u++){const f=r+i*t.colorMode.length*u;for(let m=0;m<i;m++){let x=t.xFlip?i-m-1:m,p=t.yFlip?s-u-1:u;if(t.rotate){const Ce=x;x=p,p=Ce}const C=p*e.stride+e.offset+x*e.format.length,d=o.getUint8(C),_=o.getUint8(C+1),O=o.getUint8(C+2),v=f+m*t.colorMode.length;h?(c.setUint8(v,O),c.setUint8(v+1,_),c.setUint8(v+2,d)):(c.setUint8(v,d),c.setUint8(v+1,_),c.setUint8(v+2,O)),t.colorMode.length===4&&c.setUint8(v+3,255)}}return a}function ce(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}var ue;class Rt{constructor(e){g(this,ue);y(this,ue,e)}async convertPixelBuffer(e,t,r){const i=Tt(e,t,{colorMode:"rgba"},0,r.width,r.height);return l(this,ue).call(this,i,r.width,r.height)}}ue=new WeakMap;class Lt{generateFillImageWrites(e,t){const i=[],o=new Uint8Array(4095),a=Math.min(t.length,4075);o.set(t.subarray(0,a),20);const c=ce(o);c.setUint8(0,20),c.setUint8(1,255),c.setUint8(2,2),c.setUint8(3,43),c.setUint8(4,Me(1,!0,a>=t.length)),c.setUint16(5,256),c.setUint16(7,256),c.setUint16(9,e.pixelPosition.x),c.setUint16(11,e.pixelPosition.y),c.setUint16(13,e.pixelSize.width),c.setUint16(15,e.pixelSize.height),c.setUint16(18,t.length),i.push(o);let h=t.length-a;for(let u=2;h>0;u++){const f=new Uint8Array(4095),m=Math.min(h,4090),x=t.length-h;h-=m,f.set(t.subarray(x,x+m),5);const p=ce(f);p.setUint8(0,20),p.setUint8(1,255),p.setUint8(2,2),p.setUint8(3,43),p.setUint8(4,Me(u,!1,h===0)),i.push(f)}return i}}function Me(n,e,t){let r=n|32;return e&&(r|=128),t&&(r|=64),r}var $,B,N,H,ie,Je,Qe;class Dt{constructor(e,t){g(this,ie);b(this,"deviceProperties");g(this,$);g(this,B,new Map);g(this,N,new Set);g(this,H,new Set);this.deviceProperties=e,y(this,$,t);for(const r of this.deviceProperties.CONTROLS)r.type==="button"&&l(this,B).set(r.hidId,r)}handleInput(e,t){if(t[2]===43)return;const r=ce(t);e===19?E(this,ie,Je).call(this,r):e===17&&E(this,ie,Qe).call(this,r)}}$=new WeakMap,B=new WeakMap,N=new WeakMap,H=new WeakMap,ie=new WeakSet,Je=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==2||e.getUint8(2)!==0||e.getUint8(4)!==1)return;const t=[],r=new Set;for(let i=5;i<e.byteLength;i+=1){const s=e.getInt8(i);if(s===0)break;const o=l(this,B).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,N)){if(r.has(i))continue;const s=l(this,B).get(i);s&&l(this,$).emit("up",s),l(this,N).delete(i)}for(const i of t)l(this,N).has(i.hidId)||(l(this,N).add(i.hidId),l(this,$).emit("down",i))},Qe=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==11||e.getUint8(2)!==0)return;const t=[],r=new Set;for(let i=3;i<e.byteLength;i+=2){const s=e.getUint16(i,!1);if(s===0)break;const o=l(this,B).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,H)){if(r.has(i))continue;const s=l(this,B).get(i);s&&l(this,$).emit("up",s),l(this,H).delete(i)}for(const i of t)l(this,H).has(i.hidId)||(l(this,H).add(i.hidId),l(this,$).emit("down",i))};var J;class At{constructor(e){g(this,J);y(this,J,e)}async setBrightness(e){if(e<0||e>100)throw new RangeError("Expected brightness percentage to be between 0 and 100");e=Math.max(e,1);const t=new Uint8Array([17,255,15,43,0,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,J).sendReports([t])}async resetToLogo(){const e=new Uint8Array([3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,J).sendFeatureReport(e)}}J=new WeakMap;const Pe={MODEL:z.MX_CREATIVE_KEYPAD,PRODUCT_NAME:je[z.MX_CREATIVE_KEYPAD],CONTROLS:St([...Ct(3,3,{width:118,height:118},{x:23,y:6},{x:40,y:40}),{type:"button",row:3,column:0,index:9,hidId:417,feedbackType:"none"},{type:"button",row:3,column:1,index:10,hidId:418,feedbackType:"none"}]),PANEL_SIZE:{width:480,height:480}};function Fe(n,e){const t=new Pt;return new bt(n,e,{deviceProperties:Pe,events:t,properties:new At(n),buttonsLcd:new It(new Lt,new Rt(e.encodeJPEG),n,Pe),inputService:new Dt(Pe,t)})}const _t=[new Uint8Array([17,255,11,59,1,161,3,0,0,0,0,0,0,0,0,0,0,0,0,0]),new Uint8Array([17,255,11,59,1,162,3,0,0,0,0,0,0,0,0,0,0,0,0,0])];class Ot{constructor(e){b(this,"device");this.device=e}get CONTROLS(){return this.device.CONTROLS}get MODEL(){return this.device.MODEL}get PRODUCT_NAME(){return this.device.PRODUCT_NAME}calculateFillPanelDimensions(...e){return this.device.calculateFillPanelDimensions(...e)}async close(){return this.device.close()}async getHidDeviceInfo(...e){return this.device.getHidDeviceInfo(...e)}async fillKeyColor(...e){return this.device.fillKeyColor(...e)}async fillKeyBuffer(...e){return this.device.fillKeyBuffer(...e)}async fillPanelBuffer(...e){return this.device.fillPanelBuffer(...e)}async clearKey(...e){return this.device.clearKey(...e)}async clearPanel(...e){return this.device.clearPanel(...e)}async setBrightness(...e){return this.device.setBrightness(...e)}async resetToLogo(...e){return this.device.resetToLogo(...e)}eventNames(){return this.device.eventNames()}listeners(e){return this.device.listeners(e)}listenerCount(e){return this.device.listenerCount(e)}emit(e,...t){return this.device.emit(e,...t)}on(e,t,r){return this.device.on(e,t,r),this}addListener(e,t,r){return this.device.addListener(e,t,r),this}once(e,t,r){return this.device.once(e,t,r),this}removeListener(e,t,r,i){return this.device.removeListener(e,t,r,i),this}off(e,t,r,i){return this.device.off(e,t,r,i),this}removeAllListeners(e){return this.device.removeAllListeners(e),this}}const _e=1133,kt={[z.MX_CREATIVE_KEYPAD]:{productIds:[50004],factory:Fe,initWrites:_t},[z.MX_CREATIVE_DIALPAD]:{productIds:[48128],factory:Fe}},Ut=Object.entries(kt).map(([n,e])=>{const t=n;return{id:t,productName:je[t],...e}});class et extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Mt extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const $e=n=>globalThis.DOMException===void 0?new Mt(n):new DOMException(n),Be=n=>{const e=n.reason===void 0?$e("This operation was aborted."):n.reason;return e instanceof Error?e:$e(e)};function Ft(n,e){const{milliseconds:t,fallback:r,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o;const c=new Promise((h,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&u(Be(m));const x=()=>{u(Be(m))};m.addEventListener("abort",x,{once:!0}),n.finally(()=>{m.removeEventListener("abort",x)})}if(t===Number.POSITIVE_INFINITY){n.then(h,u);return}const f=new et;o=s.setTimeout.call(void 0,()=>{if(r){try{h(r())}catch(m){u(m)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?h():i instanceof Error?u(i):(f.message=i??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{h(await n)}catch(m){u(m)}})()}).finally(()=>{c.clear()});return c.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},c}function $t(n,e,t){let r=0,i=n.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}var L;class Bt{constructor(){g(this,L,[])}enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,id:t.id,run:e};if(this.size===0||l(this,L)[this.size-1].priority>=t.priority){l(this,L).push(r);return}const i=$t(l(this,L),r,(s,o)=>o.priority-s.priority);l(this,L).splice(i,0,r)}setPriority(e,t){const r=l(this,L).findIndex(s=>s.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=l(this,L).splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=l(this,L).shift();return e==null?void 0:e.run}filter(e){return l(this,L).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return l(this,L).length}}L=new WeakMap;var Q,ee,V,he,te,fe,D,ne,S,de,A,re,F,me,Ee,w,tt,nt,rt,it,st,ye,Re,Le,pe,ot,we;class Vt extends Ae{constructor(t){var r,i;super();g(this,w);g(this,Q);g(this,ee);g(this,V,0);g(this,he);g(this,te);g(this,fe,0);g(this,D);g(this,ne);g(this,S);g(this,de);g(this,A,0);g(this,re);g(this,F);g(this,me);g(this,Ee,1n);b(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Bt,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);y(this,Q,t.carryoverConcurrencyCount),y(this,ee,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),y(this,he,t.intervalCap),y(this,te,t.interval),y(this,S,new t.queueClass),y(this,de,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,y(this,me,t.throwOnTimeout===!0),y(this,F,t.autoStart===!1)}get concurrency(){return l(this,re)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);y(this,re,t),E(this,w,pe).call(this)}setPriority(t,r){l(this,S).setPriority(t,r)}async add(t,r={}){return r.id??(r.id=(oe(this,Ee)._++).toString()),r={timeout:this.timeout,throwOnTimeout:l(this,me),...r},new Promise((i,s)=>{l(this,S).enqueue(async()=>{var o;oe(this,A)._++,oe(this,V)._++;try{(o=r.signal)==null||o.throwIfAborted();let a=t({signal:r.signal});r.timeout&&(a=Ft(Promise.resolve(a),{milliseconds:r.timeout})),r.signal&&(a=Promise.race([a,E(this,w,ot).call(this,r.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof et&&!r.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{E(this,w,rt).call(this)}},r),this.emit("add"),E(this,w,ye).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return l(this,F)?(y(this,F,!1),E(this,w,pe).call(this),this):this}pause(){y(this,F,!0)}clear(){y(this,S,new(l(this,de)))}async onEmpty(){l(this,S).size!==0&&await E(this,w,we).call(this,"empty")}async onSizeLessThan(t){l(this,S).size<t||await E(this,w,we).call(this,"next",()=>l(this,S).size<t)}async onIdle(){l(this,A)===0&&l(this,S).size===0||await E(this,w,we).call(this,"idle")}get size(){return l(this,S).size}sizeBy(t){return l(this,S).filter(t).length}get pending(){return l(this,A)}get isPaused(){return l(this,F)}}Q=new WeakMap,ee=new WeakMap,V=new WeakMap,he=new WeakMap,te=new WeakMap,fe=new WeakMap,D=new WeakMap,ne=new WeakMap,S=new WeakMap,de=new WeakMap,A=new WeakMap,re=new WeakMap,F=new WeakMap,me=new WeakMap,Ee=new WeakMap,w=new WeakSet,tt=function(){return l(this,ee)||l(this,V)<l(this,he)},nt=function(){return l(this,A)<l(this,re)},rt=function(){oe(this,A)._--,E(this,w,ye).call(this),this.emit("next")},it=function(){E(this,w,Le).call(this),E(this,w,Re).call(this),y(this,ne,void 0)},st=function(){const t=Date.now();if(l(this,D)===void 0){const r=l(this,fe)-t;if(r<0)y(this,V,l(this,Q)?l(this,A):0);else return l(this,ne)===void 0&&y(this,ne,setTimeout(()=>{E(this,w,it).call(this)},r)),!0}return!1},ye=function(){if(l(this,S).size===0)return l(this,D)&&clearInterval(l(this,D)),y(this,D,void 0),this.emit("empty"),l(this,A)===0&&this.emit("idle"),!1;if(!l(this,F)){const t=!l(this,w,st);if(l(this,w,tt)&&l(this,w,nt)){const r=l(this,S).dequeue();return r?(this.emit("active"),r(),t&&E(this,w,Re).call(this),!0):!1}}return!1},Re=function(){l(this,ee)||l(this,D)!==void 0||(y(this,D,setInterval(()=>{E(this,w,Le).call(this)},l(this,te))),y(this,fe,Date.now()+l(this,te)))},Le=function(){l(this,V)===0&&l(this,A)===0&&l(this,D)&&(clearInterval(l(this,D)),y(this,D,void 0)),y(this,V,l(this,Q)?l(this,A):0),E(this,w,pe).call(this)},pe=function(){for(;E(this,w,ye).call(this););},ot=async function(t){return new Promise((r,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},we=async function(t,r){return new Promise(i=>{const s=()=>{r&&!r()||(this.off(t,s),i())};this.on(t,s)})};class Kt extends Ae{constructor(t){super();b(this,"device");b(this,"reportQueue",new Vt({concurrency:1}));this.device=t,this.device.addEventListener("inputreport",r=>{const i=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength);this.emit("input",r.reportId,i)})}async close(){return this.device.close()}async forget(){return this.device.forget()}async sendFeatureReport(t){return this.device.sendFeatureReport(t[0],t.subarray(1))}async getFeatureReport(t,r){const i=await this.device.receiveFeatureReport(t);return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}async sendReports(t){return this.reportQueue.add(async()=>{for(const r of t)await this.device.sendReport(r[0],r.subarray(1))})}async getDeviceInfo(){return{path:void 0,productId:this.device.productId,vendorId:this.device.vendorId,serialNumber:void 0}}}async function zt(n,e,t){const r=await new Promise((i,s)=>{const o=document.createElement("canvas");o.width=e,o.height=t;const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=a.createImageData(e,t);c.data.set(n),a.putImageData(c,0,0),o.toBlob(h=>{h?i(h):s(new Error("No image generated"))},"image/jpeg",.9)}else s(new Error("Failed to get canvas context"))});return new Uint8Array(await r.arrayBuffer())}var ge;class Nt extends Ot{constructor(t,r){super(t);g(this,ge);y(this,ge,r)}async forget(){await l(this,ge).forget()}async fillKeyCanvas(t,r){const i=r.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Failed to get canvas context");const s=this.CONTROLS.find(a=>a.type==="button"&&a.index===t);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=i.getImageData(0,0,s.pixelSize.width,s.pixelSize.height);return this.device.fillKeyBuffer(t,o.data,{format:"rgba"})}async fillPanelCanvas(t,r){const i=t.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Failed to get canvas context");const s=this.device.calculateFillPanelDimensions(r);if(!s)throw new Error("Panel does not support filling");const o=i.getImageData(0,0,s.width,s.height);return this.device.fillPanelBuffer(o.data,{format:"rgba"})}}ge=new WeakMap;async function Ht(n){const e=await navigator.hid.requestDevice({filters:[{vendorId:_e}]});return Promise.all(e.map(async t=>at(t,n)))}async function qt(n){const t=(await navigator.hid.getDevices()).filter(i=>i.vendorId===_e);return(await Promise.all(t.map(async i=>at(i,n).catch(s=>null)))).filter(i=>!!i)}async function at(n,e){const t=Ut.find(r=>n.vendorId===_e&&r.productIds.includes(n.productId));if(!t)throw new Error("Stream Deck is of unexpected type.");await n.open();try{const r={encodeJPEG:zt,...e},i=new Kt(n);t.initWrites&&await i.sendReports(t.initWrites);const s=t.factory(i,r||{});return new Nt(s,i)}catch(r){throw await n.close().catch(()=>null),r}}function Gt(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const t=document.implementation.createHTMLDocument(),r=t.createElement("base"),i=t.createElement("a");return t.head.appendChild(r),t.body.appendChild(i),e&&(r.href=e),i.href=n,i.href}const Xt=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function K(n){const e=[];for(let t=0,r=n.length;t<r;t++)e.push(n[t]);return e}let q=null;function ct(n={}){return q||(n.includeStyleProperties?(q=n.includeStyleProperties,q):(q=K(window.getComputedStyle(document.documentElement)),q))}function xe(n,e){const r=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return r?parseFloat(r.replace("px","")):0}function Wt(n){const e=xe(n,"border-left-width"),t=xe(n,"border-right-width");return n.clientWidth+e+t}function Zt(n){const e=xe(n,"border-top-width"),t=xe(n,"border-bottom-width");return n.clientHeight+e+t}function lt(n,e={}){const t=e.width||Wt(n),r=e.height||Zt(n);return{width:t,height:r}}function jt(){let n,e;try{e=process}catch{}const t=e&&e.env?e.env.devicePixelRatio:null;return t&&(n=parseInt(t,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const T=16384;function Yt(n){(n.width>T||n.height>T)&&(n.width>T&&n.height>T?n.width>n.height?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T):n.width>T?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T))}function ve(n){return new Promise((e,t)=>{const r=new Image;r.onload=()=>{r.decode().then(()=>{requestAnimationFrame(()=>e(r))})},r.onerror=t,r.crossOrigin="anonymous",r.decoding="async",r.src=n})}async function Jt(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Qt(n,e,t){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${t}`),i.setAttribute("viewBox",`0 0 ${e} ${t}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(n),Jt(i)}const I=(n,e)=>{if(n instanceof e)return!0;const t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||I(t,e)};function en(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function tn(n,e){return ct(e).map(t=>{const r=n.getPropertyValue(t),i=n.getPropertyPriority(t);return`${t}: ${r}${i?" !important":""};`}).join(" ")}function nn(n,e,t,r){const i=`.${n}:${e}`,s=t.cssText?en(t):tn(t,r);return document.createTextNode(`${i}{${s}}`)}function Ve(n,e,t,r){const i=window.getComputedStyle(n,t),s=i.getPropertyValue("content");if(s===""||s==="none")return;const o=Xt();try{e.className=`${e.className} ${o}`}catch{return}const a=document.createElement("style");a.appendChild(nn(o,t,i,r)),e.appendChild(a)}function rn(n,e,t){Ve(n,e,":before",t),Ve(n,e,":after",t)}const Ke="application/font-woff",ze="image/jpeg",sn={woff:Ke,woff2:Ke,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:ze,jpeg:ze,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function on(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function Oe(n){const e=on(n).toLowerCase();return sn[e]||""}function an(n){return n.split(/,/)[1]}function De(n){return n.search(/^(data:)/)!==-1}function cn(n,e){return`data:${e};base64,${n}`}async function ut(n,e,t){const r=await fetch(n,e);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((s,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{s(t({res:r,result:a.result}))}catch(c){o(c)}},a.readAsDataURL(i)})}const Ie={};function ln(n,e,t){let r=n.replace(/\?.*/,"");return t&&(r=n),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}async function ke(n,e,t){const r=ln(n,e,t.includeQueryParams);if(Ie[r]!=null)return Ie[r];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let i;try{const s=await ut(n,t.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),an(a)));i=cn(s,e)}catch(s){i=t.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return Ie[r]=i,i}async function un(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):ve(e)}async function hn(n,e){if(n.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=n.clientWidth,s.height=n.clientHeight,o==null||o.drawImage(n,0,0,s.width,s.height);const a=s.toDataURL();return ve(a)}const t=n.poster,r=Oe(t),i=await ke(t,r,e);return ve(i)}async function fn(n,e){var t;try{if(!((t=n==null?void 0:n.contentDocument)===null||t===void 0)&&t.body)return await be(n.contentDocument.body,e,!0)}catch{}return n.cloneNode(!1)}async function dn(n,e){return I(n,HTMLCanvasElement)?un(n):I(n,HTMLVideoElement)?hn(n,e):I(n,HTMLIFrameElement)?fn(n,e):n.cloneNode(ht(n))}const mn=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT",ht=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SVG";async function gn(n,e,t){var r,i;if(ht(e))return e;let s=[];return mn(n)&&n.assignedNodes?s=K(n.assignedNodes()):I(n,HTMLIFrameElement)&&(!((r=n.contentDocument)===null||r===void 0)&&r.body)?s=K(n.contentDocument.body.childNodes):s=K(((i=n.shadowRoot)!==null&&i!==void 0?i:n).childNodes),s.length===0||I(n,HTMLVideoElement)||await s.reduce((o,a)=>o.then(()=>be(a,t)).then(c=>{c&&e.appendChild(c)}),Promise.resolve()),e}function yn(n,e,t){const r=e.style;if(!r)return;const i=window.getComputedStyle(n);i.cssText?(r.cssText=i.cssText,r.transformOrigin=i.transformOrigin):ct(t).forEach(s=>{let o=i.getPropertyValue(s);s==="font-size"&&o.endsWith("px")&&(o=`${Math.floor(parseFloat(o.substring(0,o.length-2)))-.1}px`),I(n,HTMLIFrameElement)&&s==="display"&&o==="inline"&&(o="block"),s==="d"&&e.getAttribute("d")&&(o=`path(${e.getAttribute("d")})`),r.setProperty(s,o,i.getPropertyPriority(s))})}function pn(n,e){I(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),I(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function wn(n,e){if(I(n,HTMLSelectElement)){const t=e,r=Array.from(t.children).find(i=>n.value===i.getAttribute("value"));r&&r.setAttribute("selected","")}}function xn(n,e,t){return I(e,Element)&&(yn(n,e,t),rn(n,e,t),pn(n,e),wn(n,e)),e}async function vn(n,e){const t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;const r={};for(let s=0;s<t.length;s++){const a=t[s].getAttribute("xlink:href");if(a){const c=n.querySelector(a),h=document.querySelector(a);!c&&h&&!r[a]&&(r[a]=await be(h,e,!0))}}const i=Object.values(r);if(i.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(s,"defs");o.appendChild(a);for(let c=0;c<i.length;c++)a.appendChild(i[c]);n.appendChild(o)}return n}async function be(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(r=>dn(r,e)).then(r=>gn(n,r,e)).then(r=>xn(n,r,e)).then(r=>vn(r,e))}const ft=/url\((['"]?)([^'"]+?)\1\)/g,En=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,bn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Cn(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function Sn(n){const e=[];return n.replace(ft,(t,r,i)=>(e.push(i),t)),e.filter(t=>!De(t))}async function Pn(n,e,t,r,i){try{const s=t?Gt(e,t):e,o=Oe(e);let a;return i||(a=await ke(s,o,r)),n.replace(Cn(e),`$1${a}$3`)}catch{}return n}function In(n,{preferredFontFormat:e}){return e?n.replace(bn,t=>{for(;;){const[r,,i]=En.exec(t)||[];if(!i)return"";if(i===e)return`src: ${r};`}}):n}function dt(n){return n.search(ft)!==-1}async function mt(n,e,t){if(!dt(n))return n;const r=In(n,t);return Sn(r).reduce((s,o)=>s.then(a=>Pn(a,o,e,t)),Promise.resolve(r))}async function G(n,e,t){var r;const i=(r=e.style)===null||r===void 0?void 0:r.getPropertyValue(n);if(i){const s=await mt(i,null,t);return e.style.setProperty(n,s,e.style.getPropertyPriority(n)),!0}return!1}async function Tn(n,e){await G("background",n,e)||await G("background-image",n,e),await G("mask",n,e)||await G("-webkit-mask",n,e)||await G("mask-image",n,e)||await G("-webkit-mask-image",n,e)}async function Rn(n,e){const t=I(n,HTMLImageElement);if(!(t&&!De(n.src))&&!(I(n,SVGImageElement)&&!De(n.href.baseVal)))return;const r=t?n.src:n.href.baseVal,i=await ke(r,Oe(r),e);await new Promise((s,o)=>{n.onload=s,n.onerror=e.onImageErrorHandler?(...c)=>{try{s(e.onImageErrorHandler(...c))}catch(h){o(h)}}:o;const a=n;a.decode&&(a.decode=s),a.loading==="lazy"&&(a.loading="eager"),t?(n.srcset="",n.src=i):n.href.baseVal=i})}async function Ln(n,e){const r=K(n.childNodes).map(i=>gt(i,e));await Promise.all(r).then(()=>n)}async function gt(n,e){I(n,Element)&&(await Tn(n,e),await Rn(n,e),await Ln(n,e))}function Dn(n,e){const{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);const r=e.style;return r!=null&&Object.keys(r).forEach(i=>{t[i]=r[i]}),n}const Ne={};async function He(n){let e=Ne[n];if(e!=null)return e;const r=await(await fetch(n)).text();return e={url:n,cssText:r},Ne[n]=e,e}async function qe(n,e){let t=n.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(t.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(r,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),ut(a,e.fetchRequestInit,({result:c})=>(t=t.replace(o,`url(${c})`),[o,c]))});return Promise.all(s).then(()=>t)}function Ge(n){if(n==null)return[];const e=[],t=/(\/\*[\s\S]*?\*\/)/gi;let r=n.replace(t,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=i.exec(r);if(c===null)break;e.push(c[0])}r=r.replace(i,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let c=s.exec(r);if(c===null){if(c=a.exec(r),c===null)break;s.lastIndex=a.lastIndex}else a.lastIndex=s.lastIndex;e.push(c[0])}return e}async function An(n,e){const t=[],r=[];return n.forEach(i=>{if("cssRules"in i)try{K(i.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let a=o+1;const c=s.href,h=He(c).then(u=>qe(u,e)).then(u=>Ge(u).forEach(f=>{try{i.insertRule(f,f.startsWith("@import")?a+=1:i.cssRules.length)}catch(m){console.error("Error inserting rule from remote css",{rule:f,error:m})}})).catch(u=>{console.error("Error loading remote css",u.toString())});r.push(h)}})}catch(s){const o=n.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&r.push(He(i.href).then(a=>qe(a,e)).then(a=>Ge(a).forEach(c=>{o.insertRule(c,o.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(n.forEach(i=>{if("cssRules"in i)try{K(i.cssRules||[]).forEach(s=>{t.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${i.href}`,s)}}),t))}function _n(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>dt(e.style.getPropertyValue("src")))}async function On(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const t=K(n.ownerDocument.styleSheets),r=await An(t,e);return _n(r)}function yt(n){return n.trim().replace(/["']/g,"")}function kn(n){const e=new Set;function t(r){(r.style.fontFamily||getComputedStyle(r).fontFamily).split(",").forEach(s=>{e.add(yt(s))}),Array.from(r.children).forEach(s=>{s instanceof HTMLElement&&t(s)})}return t(n),e}async function Un(n,e){const t=await On(n,e),r=kn(n);return(await Promise.all(t.filter(s=>r.has(yt(s.style.fontFamily))).map(s=>{const o=s.parentStyleSheet?s.parentStyleSheet.href:null;return mt(s.cssText,o,e)}))).join(`
`)}async function Mn(n,e){const t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Un(n,e);if(t){const r=document.createElement("style"),i=document.createTextNode(t);r.appendChild(i),n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r)}}async function Fn(n,e={}){const{width:t,height:r}=lt(n,e),i=await be(n,e,!0);return await Mn(i,e),await gt(i,e),Dn(i,e),await Qt(i,t,r)}async function $n(n,e={}){const{width:t,height:r}=lt(n,e),i=await Fn(n,e),s=await ve(i),o=document.createElement("canvas"),a=o.getContext("2d"),c=e.pixelRatio||jt(),h=e.canvasWidth||t,u=e.canvasHeight||r;return o.width=h*c,o.height=u*c,e.skipAutoScale||Yt(o),o.style.width=`${h}`,o.style.height=`${u}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}function Bn(){const n="0123456789ABCDEF";let e="#";for(let t=0;t<6;t++)e+=n[Math.floor(Math.random()*16)];return e}class Vn{constructor(){b(this,"element");b(this,"run",!1);b(this,"running")}async start(e){const t=e.calculateFillPanelDimensions();if(this.element=document.querySelector("#image-source")||void 0,this.element&&(this.element.style.display="block",t&&(this.element.style.width=`${t.width}px`,this.element.style.height=`${t.height}px`)),!this.run){this.run=!0;const r=()=>{if(this.element&&this.run){const i=this.element;$n(i).then(async s=>{this.running=e.fillPanelCanvas(s),await this.running,this.running=void 0,r()}).catch(console.error)}};r()}}async stop(e){this.element&&(this.element.style.display="none"),this.run=!1,await this.running,await e.clearPanel()}async keyDown(e,t){this.element&&(this.element.style.background=Bn())}async keyUp(e,t){}}class pt{constructor(){b(this,"pressed",[])}async start(e){await e.clearPanel()}async stop(e){await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}function Te(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n+1))+n}class Kn{constructor(){b(this,"interval");b(this,"running")}async start(e){if(!this.interval){const t=async()=>{if(!this.running){const r=Te(0,255),i=Te(0,255),s=Te(0,255);console.log("Filling with rgb(%d, %d, %d)",r,i,s);const o=[];for(const a of e.CONTROLS)a.type==="button"&&a.feedbackType!=="none"&&o.push(e.fillKeyColor(a.index,r,i,s));this.running=Promise.all(o),await this.running,this.running=void 0}};this.interval=window.setInterval(()=>{t().catch(r=>console.log(r))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){}async keyUp(e,t){}}class zn{constructor(){b(this,"pressed",[]);b(this,"counter",0);b(this,"interval");b(this,"running")}async drawButtons(e,t,r){const i=[];for(const{control:s,canvas:o}of t){const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=r+s.index;a.save(),a.clearRect(0,0,o.width,o.height),a.font=`${o.height*.8}px "Arial"`,a.strokeStyle="blue",a.lineWidth=1,a.strokeText(c.toString(),8,o.height*.9,o.width*.8),a.fillStyle="white",a.fillText(c.toString(),8,o.height*.9,o.width*.8);const h=a.getImageData(0,0,o.width,o.height);i.push(e.fillKeyBuffer(s.index,h.data,{format:"rgba"})),a.restore()}}await Promise.all(i)}async start(e){await e.clearPanel(),this.counter=0;const r=e.CONTROLS.filter(i=>i.type==="button"&&i.feedbackType==="lcd").sort((i,s)=>s.index-i.index).map(i=>{const s=document.createElement("canvas");return s.width=i.pixelSize.width,s.height=i.pixelSize.height,{control:i,canvas:s}});if(await this.drawButtons(e,r,this.counter),!this.interval){const i=async()=>{this.running||(this.running=this.drawButtons(e,r,++this.counter),await this.running,this.running=void 0)};this.interval=window.setInterval(()=>{i().catch(s=>console.error(s))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}{const n=document.querySelector("#version_str");n&&(n.innerHTML="v0.1.0")}function U(n){const e=document.getElementById("log");e&&(e.textContent=`${n}
${e.textContent??""}`)}const ae=document.getElementById("demo-select"),Xe=document.getElementById("consent-button");let P=null,M=new pt;async function We(){if(ae){switch(console.log(`Selected demo: ${ae.value}`),P&&await M.stop(P),ae.value){case"rapid-fill":M=new Kn;break;case"dom":M=new Vn;break;case"chase":M=new zn;break;case"fill-when-pressed":default:M=new pt;break}P&&await M.start(P)}}async function Ze(n){const e=await n.getHidDeviceInfo();U(`Device opened. Serial: ${e.serialNumber}`),n.on("down",t=>{t.type==="button"?(U(`Key ${t.index} down`),M.keyDown(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("up",t=>{t.type==="button"?(U(`Key ${t.index} up`),M.keyUp(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("rotate",(t,r)=>{U(`Encoder ${t.index} rotate (${r})`)}),await M.start(n),await n.setBrightness(70)}if(Xe){const n=async()=>{const r=await qt();r.length>0&&(P=r[0],Ze(P).catch(console.error)),console.log(r)};window.addEventListener("load",()=>{n().catch(r=>console.error(r))});const e=document.getElementById("brightness-range");e&&e.addEventListener("input",r=>{const i=e.value;P&&P.setBrightness(i).catch(console.error)}),ae&&(ae.addEventListener("input",()=>{We().catch(console.error)}),We().catch(console.error));const t=async()=>{P&&(U("Closing device"),M.stop(P).catch(console.error),await P.close(),P=null);try{const r=await Ht();if(P=r[0],r.length===0){U("No device was selected");return}}catch(r){U(`No device access granted: ${r}`);return}Ze(P).catch(console.error)};Xe.addEventListener("click",()=>{t().catch(r=>console.error(r))}),U("Page loaded")}
