var dt=Object.defineProperty;var Oe=n=>{throw TypeError(n)};var gt=(n,e,t)=>e in n?dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>gt(n,typeof e!="symbol"?e+"":e,t),be=(n,e,t)=>e.has(n)||Oe("Cannot "+t);var l=(n,e,t)=>(be(n,e,"read from private field"),t?t.call(n):e.get(n)),p=(n,e,t)=>e.has(n)?Oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),m=(n,e,t,r)=>(be(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),E=(n,e,t)=>(be(n,e,"access private method"),t);var de=(n,e,t,r)=>({set _(i){m(n,e,i,t)},get _(){return l(n,e,r)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var z;(function(n){n.MX_CREATIVE_KEYPAD="mx-creative-keypad",n.MX_CREATIVE_DIALPAD="mx-creative-dialpad"})(z||(z={}));const Xe={[z.MX_CREATIVE_KEYPAD]:"MX Creative Keypad",[z.MX_CREATIVE_DIALPAD]:"MX Creative Dialpad"};function mt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var je={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,h,u){this.fn=c,this.context=h,this.once=u||!1}function s(c,h,u,f,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var x=new i(u,f||c,g),y=t?t+h:h;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],x]:c._events[y].push(x):(c._events[y]=x,c._eventsCount++),c}function o(c,h){--c._eventsCount===0?c._events=new r:delete c._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],u,f;if(this._eventsCount===0)return h;for(f in u=this._events)e.call(u,f)&&h.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},a.prototype.listeners=function(h){var u=t?t+h:h,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,x=f.length,y=new Array(x);g<x;g++)y[g]=f[g].fn;return y},a.prototype.listenerCount=function(h){var u=t?t+h:h,f=this._events[u];return f?f.fn?1:f.length:0},a.prototype.emit=function(h,u,f,g,x,y){var C=t?t+h:h;if(!this._events[C])return!1;var d=this._events[C],A=arguments.length,_,v;if(d.fn){switch(d.once&&this.removeListener(h,d.fn,void 0,!0),A){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,f),!0;case 4:return d.fn.call(d.context,u,f,g),!0;case 5:return d.fn.call(d.context,u,f,g,x),!0;case 6:return d.fn.call(d.context,u,f,g,x,y),!0}for(v=1,_=new Array(A-1);v<A;v++)_[v-1]=arguments[v];d.fn.apply(d.context,_)}else{var Ee=d.length,re;for(v=0;v<Ee;v++)switch(d[v].once&&this.removeListener(h,d[v].fn,void 0,!0),A){case 1:d[v].fn.call(d[v].context);break;case 2:d[v].fn.call(d[v].context,u);break;case 3:d[v].fn.call(d[v].context,u,f);break;case 4:d[v].fn.call(d[v].context,u,f,g);break;default:if(!_)for(re=1,_=new Array(A-1);re<A;re++)_[re-1]=arguments[re];d[v].fn.apply(d[v].context,_)}}return!0},a.prototype.on=function(h,u,f){return s(this,h,u,f,!1)},a.prototype.once=function(h,u,f){return s(this,h,u,f,!0)},a.prototype.removeListener=function(h,u,f,g){var x=t?t+h:h;if(!this._events[x])return this;if(!u)return o(this,x),this;var y=this._events[x];if(y.fn)y.fn===u&&(!g||y.once)&&(!f||y.context===f)&&o(this,x);else{for(var C=0,d=[],A=y.length;C<A;C++)(y[C].fn!==u||g&&!y[C].once||f&&y[C].context!==f)&&d.push(y[C]);d.length?this._events[x]=d.length===1?d[0]:d:o(this,x)}return this},a.prototype.removeAllListeners=function(h){var u;return h?(u=t?t+h:h,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(je);var yt=je.exports;const Le=mt(yt);var q,O,oe;class pt extends Le{constructor(t,r,i){var s;super();b(this,"device");b(this,"deviceProperties");p(this,q);p(this,O);p(this,oe);this.device=t,this.deviceProperties=i.deviceProperties,m(this,q,i.properties),m(this,O,i.buttonsLcd),m(this,oe,i.inputService),(s=i.events)==null||s.listen((o,...a)=>this.emit(o,...a)),this.device.on("input",(o,a)=>l(this,oe).handleInput(o,a)),this.device.on("error",o=>{this.emit("error",o)})}get CONTROLS(){return this.deviceProperties.CONTROLS}get MODEL(){return this.deviceProperties.MODEL}get PRODUCT_NAME(){return this.deviceProperties.PRODUCT_NAME}checkValidKeyIndex(t,r){const i=this.deviceProperties.CONTROLS.find(s=>s.type==="button"&&s.index===t);if(!i)throw new TypeError("Expected a valid keyIndex");if(r&&i.feedbackType!==r)throw new TypeError("Expected a keyIndex with expected feedbackType")}calculateFillPanelDimensions(t){return l(this,O).calculateFillPanelDimensions(t)}async close(){return this.device.close()}async getHidDeviceInfo(){return this.device.getDeviceInfo()}async setBrightness(t){return l(this,q).setBrightness(t)}async resetToLogo(){return l(this,q).resetToLogo()}async fillKeyColor(t,r,i,s){this.checkValidKeyIndex(t,null),await l(this,O).fillKeyColor(t,r,i,s)}async fillKeyBuffer(t,r,i){this.checkValidKeyIndex(t,"lcd"),await l(this,O).fillKeyBuffer(t,r,i)}async fillPanelBuffer(t,r){await l(this,O).fillPanelBuffer(t,r)}async clearKey(t){this.checkValidKeyIndex(t,null),await l(this,O).clearKey(t)}async clearPanel(){const t=[];t.push(l(this,O).clearPanel()),await Promise.all(t)}}q=new WeakMap,O=new WeakMap,oe=new WeakMap;function wt(n,e,t,r,i,s=0){const o=[];for(let a=0;a<e;a++)for(let c=0;c<n;c++){const h=a*n+c,u=h+1;o.push({type:"button",row:a,column:c+s,index:h,hidId:u,feedbackType:"lcd",pixelSize:t,pixelPosition:{x:r.x+c*(t.width+i.x),y:r.y+a*(t.height+i.y)}})}return o}function xt(n){return Object.freeze(n.map(e=>Object.freeze(e)))}var G;class vt{constructor(){p(this,G,null)}emit(e,...t){if(!l(this,G))throw new Error("No listener setup");l(this,G).call(this,e,...t)}listen(e){m(this,G,e)}}G=new WeakMap;var W,X,j,R;class Et{constructor(e,t,r,i){p(this,W);p(this,X);p(this,j);p(this,R);m(this,W,e),m(this,X,t),m(this,j,r),m(this,R,i)}getLcdButtonControls(){return l(this,R).CONTROLS.filter(e=>e.type==="button"&&e.feedbackType==="lcd")}calculateLcdGridSpan(e){if(e.length===0)return null;const t=e.map(i=>i.row),r=e.map(i=>i.column);return{minRow:Math.min(...t),maxRow:Math.max(...t),minCol:Math.min(...r),maxCol:Math.max(...r)}}calculateDimensionsFromGridSpan(e,t,r){if(r)throw new Error("Not implemented");{const i=e.maxRow-e.minRow+1;return{width:(e.maxCol-e.minCol+1)*t.width,height:i*t.height}}}calculateFillPanelDimensions(e){const t=this.getLcdButtonControls(),r=this.calculateLcdGridSpan(t);return!r||t.length===0?null:this.calculateDimensionsFromGridSpan(r,t[0].pixelSize,e==null?void 0:e.withPadding)}async clearPanel(){const e=[],t=new Uint8Array(l(this,R).PANEL_SIZE.width*l(this,R).PANEL_SIZE.height*4),r=await l(this,X).convertPixelBuffer(t,{format:"rgba",offset:0,stride:l(this,R).PANEL_SIZE.width*4},l(this,R).PANEL_SIZE),i=l(this,W).generateFillImageWrites({pixelSize:l(this,R).PANEL_SIZE,pixelPosition:{x:0,y:0}},r);e.push(l(this,j).sendReports(i)),await Promise.all(e)}async clearKey(e){const t=l(this,R).CONTROLS.find(i=>i.type==="button"&&i.index===e);if(!t||t.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const r=new Uint8Array(t.pixelSize.width*t.pixelSize.height*3);await this.fillImageRangeControl(t,r,{format:"rgb",offset:0,stride:t.pixelSize.width*3})}async fillKeyColor(e,t,r,i){this.checkRGBValue(t),this.checkRGBValue(r),this.checkRGBValue(i);const s=l(this,R).CONTROLS.find(u=>u.type==="button"&&u.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height,a=new Uint8Array(o*4),c=new DataView(a.buffer,a.byteOffset,a.byteLength);c.setUint8(0,t),c.setUint8(1,r),c.setUint8(2,i),c.setUint8(3,255);const h=c.getUint32(0);for(let u=1;u<o;u++)c.setUint32(u*4,h);await this.fillImageRangeControl(s,a,{format:"rgba",offset:0,stride:s.pixelSize.width*4})}async fillKeyBuffer(e,t,r){const i=(r==null?void 0:r.format)??"rgb";this.checkSourceFormat(i);const s=l(this,R).CONTROLS.find(a=>a.type==="button"&&a.index===e);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=s.pixelSize.width*s.pixelSize.height*i.length;if(t.length!==o)throw new RangeError(`Expected image buffer of length ${o}, got length ${t.length}`);await this.fillImageRangeControl(s,t,{format:i,offset:0,stride:s.pixelSize.width*i.length})}async fillPanelBuffer(e,t){const r=(t==null?void 0:t.format)??"rgb";this.checkSourceFormat(r);const i=this.getLcdButtonControls(),s=this.calculateLcdGridSpan(i);if(!s||i.length===0)throw new Error("Panel does not support being filled");const o=this.calculateDimensionsFromGridSpan(s,i[0].pixelSize,t==null?void 0:t.withPadding),a=r.length*o.width*o.height;if(e.length!==a)throw new RangeError(`Expected image buffer of length ${a}, got length ${e.length}`);const c=o.width*r.length,h=[];for(const u of i){const f=u.row-s.minRow,g=u.column-s.minCol,x=u.pixelSize.width*r.length,y=c*f*u.pixelSize.height,C=g*x;h.push(this.fillImageRangeControl(u,e,{format:r,offset:y+C,stride:c}))}await Promise.all(h)}async fillImageRangeControl(e,t,r){if(e.feedbackType!=="lcd")throw new TypeError(`keyIndex ${e.index} does not support lcd feedback`);const i=await l(this,X).convertPixelBuffer(t,r,e.pixelSize),s=l(this,W).generateFillImageWrites({pixelSize:e.pixelSize,pixelPosition:e.pixelPosition},i);await l(this,j).sendReports(s)}checkRGBValue(e){if(e<0||e>255)throw new TypeError("Expected a valid color RGB value 0 - 255")}checkSourceFormat(e){switch(e){case"rgb":case"rgba":case"bgr":case"bgra":break;default:{const t=e;throw new TypeError(`Expected a known color format not "${t}"`)}}}}W=new WeakMap,X=new WeakMap,j=new WeakMap,R=new WeakMap;function bt(n,e,t,r,i,s){const o=se(n),a=new Uint8Array(r+i*s*t.colorMode.length),c=se(a),h=e.format.substring(0,3)!==t.colorMode.substring(0,3);for(let u=0;u<s;u++){const f=r+i*t.colorMode.length*u;for(let g=0;g<i;g++){let x=t.xFlip?i-g-1:g,y=t.yFlip?s-u-1:u;if(t.rotate){const Ee=x;x=y,y=Ee}const C=y*e.stride+e.offset+x*e.format.length,d=o.getUint8(C),A=o.getUint8(C+1),_=o.getUint8(C+2),v=f+g*t.colorMode.length;h?(c.setUint8(v,_),c.setUint8(v+1,A),c.setUint8(v+2,d)):(c.setUint8(v,d),c.setUint8(v+1,A),c.setUint8(v+2,_)),t.colorMode.length===4&&c.setUint8(v+3,255)}}return a}function se(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}var ae;class Ct{constructor(e){p(this,ae);m(this,ae,e)}async convertPixelBuffer(e,t,r){const i=bt(e,t,{colorMode:"rgba"},0,r.width,r.height);return l(this,ae).call(this,i,r.width,r.height)}}ae=new WeakMap;class St{generateFillImageWrites(e,t){const i=[],o=new Uint8Array(4095),a=Math.min(t.length,4075);o.set(t.subarray(0,a),20);const c=se(o);c.setUint8(0,20),c.setUint8(1,255),c.setUint8(2,2),c.setUint8(3,43),c.setUint8(4,ke(1,!0,a>=t.length)),c.setUint16(5,256),c.setUint16(7,256),c.setUint16(9,e.pixelPosition.x),c.setUint16(11,e.pixelPosition.y),c.setUint16(13,e.pixelSize.width),c.setUint16(15,e.pixelSize.height),c.setUint16(18,t.length),i.push(o);let h=t.length-a;for(let u=2;h>0;u++){const f=new Uint8Array(4095),g=Math.min(h,4090),x=t.length-h;h-=g,f.set(t.subarray(x,x+g),5);const y=se(f);y.setUint8(0,20),y.setUint8(1,255),y.setUint8(2,2),y.setUint8(3,43),y.setUint8(4,ke(u,!1,h===0)),i.push(f)}return i}}function ke(n,e,t){let r=n|32;return e&&(r|=128),t&&(r|=64),r}var B,V,N,H,ne,Ze,Ye;class Pt{constructor(e,t){p(this,ne);b(this,"deviceProperties");p(this,B);p(this,V,new Map);p(this,N,new Set);p(this,H,new Set);this.deviceProperties=e,m(this,B,t);for(const r of this.deviceProperties.CONTROLS)r.type==="button"&&l(this,V).set(r.hidId,r)}handleInput(e,t){if(t[2]===43)return;const r=se(t);e===19?E(this,ne,Ze).call(this,r):e===17&&E(this,ne,Ye).call(this,r)}}B=new WeakMap,V=new WeakMap,N=new WeakMap,H=new WeakMap,ne=new WeakSet,Ze=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==2||e.getUint8(2)!==0||e.getUint8(4)!==1)return;const t=[],r=new Set;for(let i=5;i<e.byteLength;i+=1){const s=e.getInt8(i);if(s===0)break;const o=l(this,V).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,N)){if(r.has(i))continue;const s=l(this,V).get(i);s&&l(this,B).emit("up",s),l(this,N).delete(i)}for(const i of t)l(this,N).has(i.hidId)||(l(this,N).add(i.hidId),l(this,B).emit("down",i))},Ye=function(e){if(e.getUint8(0)!==255||e.getUint8(1)!==11||e.getUint8(2)!==0)return;const t=[],r=new Set;for(let i=3;i<e.byteLength;i+=2){const s=e.getUint16(i,!1);if(s===0)break;const o=l(this,V).get(s);o&&(r.add(o.hidId),t.push(o))}for(const i of l(this,H)){if(r.has(i))continue;const s=l(this,V).get(i);s&&l(this,B).emit("up",s),l(this,H).delete(i)}for(const i of t)l(this,H).has(i.hidId)||(l(this,H).add(i.hidId),l(this,B).emit("down",i))};var Z;class It{constructor(e){p(this,Z);m(this,Z,e)}async setBrightness(e){if(e<0||e>100)throw new RangeError("Expected brightness percentage to be between 0 and 100");e=Math.max(e,1);const t=new Uint8Array([17,255,15,43,0,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,Z).sendReports([t])}async resetToLogo(){const e=new Uint8Array([3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);await l(this,Z).sendFeatureReport(e)}}Z=new WeakMap;const Ce={MODEL:z.MX_CREATIVE_KEYPAD,PRODUCT_NAME:Xe[z.MX_CREATIVE_KEYPAD],CONTROLS:xt([...wt(3,3,{width:118,height:118},{x:23,y:6},{x:40,y:40}),{type:"button",row:3,column:0,index:9,hidId:417,feedbackType:"none"},{type:"button",row:3,column:1,index:10,hidId:418,feedbackType:"none"}]),PANEL_SIZE:{width:480,height:480}};function Ue(n,e){const t=new vt;return new pt(n,e,{deviceProperties:Ce,events:t,properties:new It(n),buttonsLcd:new Et(new St,new Ct(e.encodeJPEG),n,Ce),inputService:new Pt(Ce,t)})}const Tt=[new Uint8Array([17,255,11,59,1,161,3,0,0,0,0,0,0,0,0,0,0,0,0,0]),new Uint8Array([17,255,11,59,1,162,3,0,0,0,0,0,0,0,0,0,0,0,0,0])];class Rt{constructor(e){b(this,"device");this.device=e}get CONTROLS(){return this.device.CONTROLS}get MODEL(){return this.device.MODEL}get PRODUCT_NAME(){return this.device.PRODUCT_NAME}calculateFillPanelDimensions(...e){return this.device.calculateFillPanelDimensions(...e)}async close(){return this.device.close()}async getHidDeviceInfo(...e){return this.device.getHidDeviceInfo(...e)}async fillKeyColor(...e){return this.device.fillKeyColor(...e)}async fillKeyBuffer(...e){return this.device.fillKeyBuffer(...e)}async fillPanelBuffer(...e){return this.device.fillPanelBuffer(...e)}async clearKey(...e){return this.device.clearKey(...e)}async clearPanel(...e){return this.device.clearPanel(...e)}async setBrightness(...e){return this.device.setBrightness(...e)}async resetToLogo(...e){return this.device.resetToLogo(...e)}eventNames(){return this.device.eventNames()}listeners(e){return this.device.listeners(e)}listenerCount(e){return this.device.listenerCount(e)}emit(e,...t){return this.device.emit(e,...t)}on(e,t,r){return this.device.on(e,t,r),this}addListener(e,t,r){return this.device.addListener(e,t,r),this}once(e,t,r){return this.device.once(e,t,r),this}removeListener(e,t,r,i){return this.device.removeListener(e,t,r,i),this}off(e,t,r,i){return this.device.off(e,t,r,i),this}removeAllListeners(e){return this.device.removeAllListeners(e),this}}const De=1133,Lt={[z.MX_CREATIVE_KEYPAD]:{productIds:[50004],factory:Ue,initWrites:Tt},[z.MX_CREATIVE_DIALPAD]:{productIds:[48128],factory:Ue}},Dt=Object.entries(Lt).map(([n,e])=>{const t=n;return{id:t,productName:Xe[t],...e}});class Je extends Error{constructor(e){super(e),this.name="TimeoutError"}}class At extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Me=n=>globalThis.DOMException===void 0?new At(n):new DOMException(n),$e=n=>{const e=n.reason===void 0?Me("This operation was aborted."):n.reason;return e instanceof Error?e:Me(e)};function _t(n,e){const{milliseconds:t,fallback:r,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o;const c=new Promise((h,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:g}=e;g.aborted&&u($e(g));const x=()=>{u($e(g))};g.addEventListener("abort",x,{once:!0}),n.finally(()=>{g.removeEventListener("abort",x)})}if(t===Number.POSITIVE_INFINITY){n.then(h,u);return}const f=new Je;o=s.setTimeout.call(void 0,()=>{if(r){try{h(r())}catch(g){u(g)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?h():i instanceof Error?u(i):(f.message=i??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{h(await n)}catch(g){u(g)}})()}).finally(()=>{c.clear()});return c.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},c}function Ot(n,e,t){let r=0,i=n.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}var k;class kt{constructor(){p(this,k,[])}enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,run:e};if(this.size&&l(this,k)[this.size-1].priority>=t.priority){l(this,k).push(r);return}const i=Ot(l(this,k),r,(s,o)=>o.priority-s.priority);l(this,k).splice(i,0,r)}dequeue(){const e=l(this,k).shift();return e==null?void 0:e.run}filter(e){return l(this,k).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return l(this,k).length}}k=new WeakMap;var Y,J,K,ce,Q,le,L,ee,S,ue,D,te,$,he,w,Qe,et,tt,nt,rt,me,Ie,Te,ye,it,pe;class Ut extends Le{constructor(t){var r,i;super();p(this,w);p(this,Y);p(this,J);p(this,K,0);p(this,ce);p(this,Q);p(this,le,0);p(this,L);p(this,ee);p(this,S);p(this,ue);p(this,D,0);p(this,te);p(this,$);p(this,he);b(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:kt,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);m(this,Y,t.carryoverConcurrencyCount),m(this,J,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),m(this,ce,t.intervalCap),m(this,Q,t.interval),m(this,S,new t.queueClass),m(this,ue,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,m(this,he,t.throwOnTimeout===!0),m(this,$,t.autoStart===!1)}get concurrency(){return l(this,te)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);m(this,te,t),E(this,w,ye).call(this)}async add(t,r={}){return r={timeout:this.timeout,throwOnTimeout:l(this,he),...r},new Promise((i,s)=>{l(this,S).enqueue(async()=>{var o;de(this,D)._++,de(this,K)._++;try{(o=r.signal)==null||o.throwIfAborted();let a=t({signal:r.signal});r.timeout&&(a=_t(Promise.resolve(a),{milliseconds:r.timeout})),r.signal&&(a=Promise.race([a,E(this,w,it).call(this,r.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof Je&&!r.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{E(this,w,tt).call(this)}},r),this.emit("add"),E(this,w,me).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return l(this,$)?(m(this,$,!1),E(this,w,ye).call(this),this):this}pause(){m(this,$,!0)}clear(){m(this,S,new(l(this,ue)))}async onEmpty(){l(this,S).size!==0&&await E(this,w,pe).call(this,"empty")}async onSizeLessThan(t){l(this,S).size<t||await E(this,w,pe).call(this,"next",()=>l(this,S).size<t)}async onIdle(){l(this,D)===0&&l(this,S).size===0||await E(this,w,pe).call(this,"idle")}get size(){return l(this,S).size}sizeBy(t){return l(this,S).filter(t).length}get pending(){return l(this,D)}get isPaused(){return l(this,$)}}Y=new WeakMap,J=new WeakMap,K=new WeakMap,ce=new WeakMap,Q=new WeakMap,le=new WeakMap,L=new WeakMap,ee=new WeakMap,S=new WeakMap,ue=new WeakMap,D=new WeakMap,te=new WeakMap,$=new WeakMap,he=new WeakMap,w=new WeakSet,Qe=function(){return l(this,J)||l(this,K)<l(this,ce)},et=function(){return l(this,D)<l(this,te)},tt=function(){de(this,D)._--,E(this,w,me).call(this),this.emit("next")},nt=function(){E(this,w,Te).call(this),E(this,w,Ie).call(this),m(this,ee,void 0)},rt=function(){const t=Date.now();if(l(this,L)===void 0){const r=l(this,le)-t;if(r<0)m(this,K,l(this,Y)?l(this,D):0);else return l(this,ee)===void 0&&m(this,ee,setTimeout(()=>{E(this,w,nt).call(this)},r)),!0}return!1},me=function(){if(l(this,S).size===0)return l(this,L)&&clearInterval(l(this,L)),m(this,L,void 0),this.emit("empty"),l(this,D)===0&&this.emit("idle"),!1;if(!l(this,$)){const t=!l(this,w,rt);if(l(this,w,Qe)&&l(this,w,et)){const r=l(this,S).dequeue();return r?(this.emit("active"),r(),t&&E(this,w,Ie).call(this),!0):!1}}return!1},Ie=function(){l(this,J)||l(this,L)!==void 0||(m(this,L,setInterval(()=>{E(this,w,Te).call(this)},l(this,Q))),m(this,le,Date.now()+l(this,Q)))},Te=function(){l(this,K)===0&&l(this,D)===0&&l(this,L)&&(clearInterval(l(this,L)),m(this,L,void 0)),m(this,K,l(this,Y)?l(this,D):0),E(this,w,ye).call(this)},ye=function(){for(;E(this,w,me).call(this););},it=async function(t){return new Promise((r,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},pe=async function(t,r){return new Promise(i=>{const s=()=>{r&&!r()||(this.off(t,s),i())};this.on(t,s)})};class Mt extends Le{constructor(t){super();b(this,"device");b(this,"reportQueue",new Ut({concurrency:1}));this.device=t,this.device.addEventListener("inputreport",r=>{const i=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength);this.emit("input",r.reportId,i)})}async close(){return this.device.close()}async forget(){return this.device.forget()}async sendFeatureReport(t){return this.device.sendFeatureReport(t[0],t.subarray(1))}async getFeatureReport(t,r){const i=await this.device.receiveFeatureReport(t);return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}async sendReports(t){return this.reportQueue.add(async()=>{for(const r of t)await this.device.sendReport(r[0],r.subarray(1))})}async getDeviceInfo(){return{path:void 0,productId:this.device.productId,vendorId:this.device.vendorId,serialNumber:void 0}}}async function $t(n,e,t){const r=await new Promise((i,s)=>{const o=document.createElement("canvas");o.width=e,o.height=t;const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=a.createImageData(e,t);c.data.set(n),a.putImageData(c,0,0),o.toBlob(h=>{h?i(h):s(new Error("No image generated"))},"image/jpeg",.9)}else s(new Error("Failed to get canvas context"))});return new Uint8Array(await r.arrayBuffer())}var fe;class Ft extends Rt{constructor(t,r){super(t);p(this,fe);m(this,fe,r)}async forget(){await l(this,fe).forget()}async fillKeyCanvas(t,r){const i=r.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Failed to get canvas context");const s=this.CONTROLS.find(a=>a.type==="button"&&a.index===t);if(!s||s.feedbackType==="none")throw new TypeError("Expected a valid keyIndex");const o=i.getImageData(0,0,s.pixelSize.width,s.pixelSize.height);return this.device.fillKeyBuffer(t,o.data,{format:"rgba"})}async fillPanelCanvas(t,r){const i=t.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Failed to get canvas context");const s=this.device.calculateFillPanelDimensions(r);if(!s)throw new Error("Panel does not support filling");const o=i.getImageData(0,0,s.width,s.height);return this.device.fillPanelBuffer(o.data,{format:"rgba"})}}fe=new WeakMap;async function Bt(n){const e=await navigator.hid.requestDevice({filters:[{vendorId:De}]});return Promise.all(e.map(async t=>st(t,n)))}async function Vt(n){const t=(await navigator.hid.getDevices()).filter(i=>i.vendorId===De);return(await Promise.all(t.map(async i=>st(i,n).catch(s=>null)))).filter(i=>!!i)}async function st(n,e){const t=Dt.find(r=>n.vendorId===De&&r.productIds.includes(n.productId));if(!t)throw new Error("Stream Deck is of unexpected type.");await n.open();try{const r={encodeJPEG:$t,...e},i=new Mt(n);t.initWrites&&await i.sendReports(t.initWrites);const s=t.factory(i,r||{});return new Ft(s,i)}catch(r){throw await n.close().catch(()=>null),r}}function Kt(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const t=document.implementation.createHTMLDocument(),r=t.createElement("base"),i=t.createElement("a");return t.head.appendChild(r),t.body.appendChild(i),e&&(r.href=e),i.href=n,i.href}const zt=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function F(n){const e=[];for(let t=0,r=n.length;t<r;t++)e.push(n[t]);return e}function we(n,e){const r=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return r?parseFloat(r.replace("px","")):0}function Nt(n){const e=we(n,"border-left-width"),t=we(n,"border-right-width");return n.clientWidth+e+t}function Ht(n){const e=we(n,"border-top-width"),t=we(n,"border-bottom-width");return n.clientHeight+e+t}function ot(n,e={}){const t=e.width||Nt(n),r=e.height||Ht(n);return{width:t,height:r}}function qt(){let n,e;try{e=process}catch{}const t=e&&e.env?e.env.devicePixelRatio:null;return t&&(n=parseInt(t,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const T=16384;function Gt(n){(n.width>T||n.height>T)&&(n.width>T&&n.height>T?n.width>n.height?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T):n.width>T?(n.height*=T/n.width,n.width=T):(n.width*=T/n.height,n.height=T))}function xe(n){return new Promise((e,t)=>{const r=new Image;r.decode=()=>e(r),r.onload=()=>e(r),r.onerror=t,r.crossOrigin="anonymous",r.decoding="async",r.src=n})}async function Wt(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Xt(n,e,t){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${t}`),i.setAttribute("viewBox",`0 0 ${e} ${t}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(n),Wt(i)}const I=(n,e)=>{if(n instanceof e)return!0;const t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||I(t,e)};function jt(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function Zt(n){return F(n).map(e=>{const t=n.getPropertyValue(e),r=n.getPropertyPriority(e);return`${e}: ${t}${r?" !important":""};`}).join(" ")}function Yt(n,e,t){const r=`.${n}:${e}`,i=t.cssText?jt(t):Zt(t);return document.createTextNode(`${r}{${i}}`)}function Fe(n,e,t){const r=window.getComputedStyle(n,t),i=r.getPropertyValue("content");if(i===""||i==="none")return;const s=zt();try{e.className=`${e.className} ${s}`}catch{return}const o=document.createElement("style");o.appendChild(Yt(s,t,r)),e.appendChild(o)}function Jt(n,e){Fe(n,e,":before"),Fe(n,e,":after")}const Be="application/font-woff",Ve="image/jpeg",Qt={woff:Be,woff2:Be,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Ve,jpeg:Ve,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function en(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function Ae(n){const e=en(n).toLowerCase();return Qt[e]||""}function tn(n){return n.split(/,/)[1]}function Re(n){return n.search(/^(data:)/)!==-1}function nn(n,e){return`data:${e};base64,${n}`}async function at(n,e,t){const r=await fetch(n,e);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((s,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{s(t({res:r,result:a.result}))}catch(c){o(c)}},a.readAsDataURL(i)})}const Se={};function rn(n,e,t){let r=n.replace(/\?.*/,"");return t&&(r=n),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}async function _e(n,e,t){const r=rn(n,e,t.includeQueryParams);if(Se[r]!=null)return Se[r];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let i;try{const s=await at(n,t.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),tn(a)));i=nn(s,e)}catch(s){i=t.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return Se[r]=i,i}async function sn(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):xe(e)}async function on(n,e){if(n.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=n.clientWidth,s.height=n.clientHeight,o==null||o.drawImage(n,0,0,s.width,s.height);const a=s.toDataURL();return xe(a)}const t=n.poster,r=Ae(t),i=await _e(t,r,e);return xe(i)}async function an(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await ve(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function cn(n,e){return I(n,HTMLCanvasElement)?sn(n):I(n,HTMLVideoElement)?on(n,e):I(n,HTMLIFrameElement)?an(n):n.cloneNode(!1)}const ln=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function un(n,e,t){var r,i;let s=[];return ln(n)&&n.assignedNodes?s=F(n.assignedNodes()):I(n,HTMLIFrameElement)&&(!((r=n.contentDocument)===null||r===void 0)&&r.body)?s=F(n.contentDocument.body.childNodes):s=F(((i=n.shadowRoot)!==null&&i!==void 0?i:n).childNodes),s.length===0||I(n,HTMLVideoElement)||await s.reduce((o,a)=>o.then(()=>ve(a,t)).then(c=>{c&&e.appendChild(c)}),Promise.resolve()),e}function hn(n,e){const t=e.style;if(!t)return;const r=window.getComputedStyle(n);r.cssText?(t.cssText=r.cssText,t.transformOrigin=r.transformOrigin):F(r).forEach(i=>{let s=r.getPropertyValue(i);i==="font-size"&&s.endsWith("px")&&(s=`${Math.floor(parseFloat(s.substring(0,s.length-2)))-.1}px`),I(n,HTMLIFrameElement)&&i==="display"&&s==="inline"&&(s="block"),i==="d"&&e.getAttribute("d")&&(s=`path(${e.getAttribute("d")})`),t.setProperty(i,s,r.getPropertyPriority(i))})}function fn(n,e){I(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),I(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function dn(n,e){if(I(n,HTMLSelectElement)){const t=e,r=Array.from(t.children).find(i=>n.value===i.getAttribute("value"));r&&r.setAttribute("selected","")}}function gn(n,e){return I(e,Element)&&(hn(n,e),Jt(n,e),fn(n,e),dn(n,e)),e}async function mn(n,e){const t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;const r={};for(let s=0;s<t.length;s++){const a=t[s].getAttribute("xlink:href");if(a){const c=n.querySelector(a),h=document.querySelector(a);!c&&h&&!r[a]&&(r[a]=await ve(h,e,!0))}}const i=Object.values(r);if(i.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(s,"defs");o.appendChild(a);for(let c=0;c<i.length;c++)a.appendChild(i[c]);n.appendChild(o)}return n}async function ve(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(r=>cn(r,e)).then(r=>un(n,r,e)).then(r=>gn(n,r)).then(r=>mn(r,e))}const ct=/url\((['"]?)([^'"]+?)\1\)/g,yn=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,pn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function wn(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function xn(n){const e=[];return n.replace(ct,(t,r,i)=>(e.push(i),t)),e.filter(t=>!Re(t))}async function vn(n,e,t,r,i){try{const s=t?Kt(e,t):e,o=Ae(e);let a;return i||(a=await _e(s,o,r)),n.replace(wn(e),`$1${a}$3`)}catch{}return n}function En(n,{preferredFontFormat:e}){return e?n.replace(pn,t=>{for(;;){const[r,,i]=yn.exec(t)||[];if(!i)return"";if(i===e)return`src: ${r};`}}):n}function lt(n){return n.search(ct)!==-1}async function ut(n,e,t){if(!lt(n))return n;const r=En(n,t);return xn(r).reduce((s,o)=>s.then(a=>vn(a,o,e,t)),Promise.resolve(r))}async function ge(n,e,t){var r;const i=(r=e.style)===null||r===void 0?void 0:r.getPropertyValue(n);if(i){const s=await ut(i,null,t);return e.style.setProperty(n,s,e.style.getPropertyPriority(n)),!0}return!1}async function bn(n,e){await ge("background",n,e)||await ge("background-image",n,e),await ge("mask",n,e)||await ge("mask-image",n,e)}async function Cn(n,e){const t=I(n,HTMLImageElement);if(!(t&&!Re(n.src))&&!(I(n,SVGImageElement)&&!Re(n.href.baseVal)))return;const r=t?n.src:n.href.baseVal,i=await _e(r,Ae(r),e);await new Promise((s,o)=>{n.onload=s,n.onerror=o;const a=n;a.decode&&(a.decode=s),a.loading==="lazy"&&(a.loading="eager"),t?(n.srcset="",n.src=i):n.href.baseVal=i})}async function Sn(n,e){const r=F(n.childNodes).map(i=>ht(i,e));await Promise.all(r).then(()=>n)}async function ht(n,e){I(n,Element)&&(await bn(n,e),await Cn(n,e),await Sn(n,e))}function Pn(n,e){const{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);const r=e.style;return r!=null&&Object.keys(r).forEach(i=>{t[i]=r[i]}),n}const Ke={};async function ze(n){let e=Ke[n];if(e!=null)return e;const r=await(await fetch(n)).text();return e={url:n,cssText:r},Ke[n]=e,e}async function Ne(n,e){let t=n.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(t.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(r,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),at(a,e.fetchRequestInit,({result:c})=>(t=t.replace(o,`url(${c})`),[o,c]))});return Promise.all(s).then(()=>t)}function He(n){if(n==null)return[];const e=[],t=/(\/\*[\s\S]*?\*\/)/gi;let r=n.replace(t,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=i.exec(r);if(c===null)break;e.push(c[0])}r=r.replace(i,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let c=s.exec(r);if(c===null){if(c=a.exec(r),c===null)break;s.lastIndex=a.lastIndex}else a.lastIndex=s.lastIndex;e.push(c[0])}return e}async function In(n,e){const t=[],r=[];return n.forEach(i=>{if("cssRules"in i)try{F(i.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let a=o+1;const c=s.href,h=ze(c).then(u=>Ne(u,e)).then(u=>He(u).forEach(f=>{try{i.insertRule(f,f.startsWith("@import")?a+=1:i.cssRules.length)}catch(g){console.error("Error inserting rule from remote css",{rule:f,error:g})}})).catch(u=>{console.error("Error loading remote css",u.toString())});r.push(h)}})}catch(s){const o=n.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&r.push(ze(i.href).then(a=>Ne(a,e)).then(a=>He(a).forEach(c=>{o.insertRule(c,i.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(n.forEach(i=>{if("cssRules"in i)try{F(i.cssRules||[]).forEach(s=>{t.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${i.href}`,s)}}),t))}function Tn(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>lt(e.style.getPropertyValue("src")))}async function Rn(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const t=F(n.ownerDocument.styleSheets),r=await In(t,e);return Tn(r)}async function Ln(n,e){const t=await Rn(n,e);return(await Promise.all(t.map(i=>{const s=i.parentStyleSheet?i.parentStyleSheet.href:null;return ut(i.cssText,s,e)}))).join(`
`)}async function Dn(n,e){const t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Ln(n,e);if(t){const r=document.createElement("style"),i=document.createTextNode(t);r.appendChild(i),n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r)}}async function An(n,e={}){const{width:t,height:r}=ot(n,e),i=await ve(n,e,!0);return await Dn(i,e),await ht(i,e),Pn(i,e),await Xt(i,t,r)}async function _n(n,e={}){const{width:t,height:r}=ot(n,e),i=await An(n,e),s=await xe(i),o=document.createElement("canvas"),a=o.getContext("2d"),c=e.pixelRatio||qt(),h=e.canvasWidth||t,u=e.canvasHeight||r;return o.width=h*c,o.height=u*c,e.skipAutoScale||Gt(o),o.style.width=`${h}`,o.style.height=`${u}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}function On(){const n="0123456789ABCDEF";let e="#";for(let t=0;t<6;t++)e+=n[Math.floor(Math.random()*16)];return e}class kn{constructor(){b(this,"element");b(this,"run",!1);b(this,"running")}async start(e){const t=e.calculateFillPanelDimensions();if(this.element=document.querySelector("#image-source")||void 0,this.element&&(this.element.style.display="block",t&&(this.element.style.width=`${t.width}px`,this.element.style.height=`${t.height}px`)),!this.run){this.run=!0;const r=()=>{if(this.element&&this.run){const i=this.element;_n(i).then(async s=>{this.running=e.fillPanelCanvas(s),await this.running,this.running=void 0,r()}).catch(console.error)}};r()}}async stop(e){this.element&&(this.element.style.display="none"),this.run=!1,await this.running,await e.clearPanel()}async keyDown(e,t){this.element&&(this.element.style.background=On())}async keyUp(e,t){}}class ft{constructor(){b(this,"pressed",[])}async start(e){await e.clearPanel()}async stop(e){await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}function Pe(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n+1))+n}class Un{constructor(){b(this,"interval");b(this,"running")}async start(e){if(!this.interval){const t=async()=>{if(!this.running){const r=Pe(0,255),i=Pe(0,255),s=Pe(0,255);console.log("Filling with rgb(%d, %d, %d)",r,i,s);const o=[];for(const a of e.CONTROLS)a.type==="button"&&a.feedbackType!=="none"&&o.push(e.fillKeyColor(a.index,r,i,s));this.running=Promise.all(o),await this.running,this.running=void 0}};this.interval=window.setInterval(()=>{t().catch(r=>console.log(r))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){}async keyUp(e,t){}}class Mn{constructor(){b(this,"pressed",[]);b(this,"counter",0);b(this,"interval");b(this,"running")}async drawButtons(e,t,r){const i=[];for(const{control:s,canvas:o}of t){const a=o.getContext("2d",{willReadFrequently:!0});if(a){const c=r+s.index;a.save(),a.clearRect(0,0,o.width,o.height),a.font=`${o.height*.8}px "Arial"`,a.strokeStyle="blue",a.lineWidth=1,a.strokeText(c.toString(),8,o.height*.9,o.width*.8),a.fillStyle="white",a.fillText(c.toString(),8,o.height*.9,o.width*.8);const h=a.getImageData(0,0,o.width,o.height);i.push(e.fillKeyBuffer(s.index,h.data,{format:"rgba"})),a.restore()}}await Promise.all(i)}async start(e){await e.clearPanel(),this.counter=0;const r=e.CONTROLS.filter(i=>i.type==="button"&&i.feedbackType==="lcd").sort((i,s)=>s.index-i.index).map(i=>{const s=document.createElement("canvas");return s.width=i.pixelSize.width,s.height=i.pixelSize.height,{control:i,canvas:s}});if(await this.drawButtons(e,r,this.counter),!this.interval){const i=async()=>{this.running||(this.running=this.drawButtons(e,r,++this.counter),await this.running,this.running=void 0)};this.interval=window.setInterval(()=>{i().catch(s=>console.error(s))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.clearPanel()}async keyDown(e,t){this.pressed.indexOf(t)===-1&&(this.pressed.push(t),await e.fillKeyColor(t,255,0,0))}async keyUp(e,t){const r=this.pressed.indexOf(t);r!==-1&&(this.pressed.splice(r,1),await e.clearKey(t))}}{const n=document.querySelector("#version_str");n&&(n.innerHTML="v0.1.0")}function U(n){const e=document.getElementById("log");e&&(e.textContent=`${n}
${e.textContent??""}`)}const ie=document.getElementById("demo-select"),qe=document.getElementById("consent-button");let P=null,M=new ft;async function Ge(){if(ie){switch(console.log(`Selected demo: ${ie.value}`),P&&await M.stop(P),ie.value){case"rapid-fill":M=new Un;break;case"dom":M=new kn;break;case"chase":M=new Mn;break;case"fill-when-pressed":default:M=new ft;break}P&&await M.start(P)}}async function We(n){const e=await n.getHidDeviceInfo();U(`Device opened. Serial: ${e.serialNumber}`),n.on("down",t=>{t.type==="button"?(U(`Key ${t.index} down`),M.keyDown(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("up",t=>{t.type==="button"?(U(`Key ${t.index} up`),M.keyUp(n,t.index).catch(console.error)):U(`Encoder ${t.index} down`)}),n.on("rotate",(t,r)=>{U(`Encoder ${t.index} rotate (${r})`)}),await M.start(n),await n.setBrightness(70)}if(qe){const n=async()=>{const r=await Vt();r.length>0&&(P=r[0],We(P).catch(console.error)),console.log(r)};window.addEventListener("load",()=>{n().catch(r=>console.error(r))});const e=document.getElementById("brightness-range");e&&e.addEventListener("input",r=>{const i=e.value;P&&P.setBrightness(i).catch(console.error)}),ie&&(ie.addEventListener("input",()=>{Ge().catch(console.error)}),Ge().catch(console.error));const t=async()=>{P&&(U("Closing device"),M.stop(P).catch(console.error),await P.close(),P=null);try{const r=await Bt();if(P=r[0],r.length===0){U("No device was selected");return}}catch(r){U(`No device access granted: ${r}`);return}We(P).catch(console.error)};qe.addEventListener("click",()=>{t().catch(r=>console.error(r))}),U("Page loaded")}
